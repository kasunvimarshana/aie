import { defined, PerspectiveOffCenterFrustum, OrientationProperty, Quaternion, Cartesian3, Matrix4, Transforms, sampleTerrain } from './cesium/cesium-imports';
import { MapzenTerrariumTerrainProvider } from './cesium/MapzenTerrariumTerrainProvider';
export * from './utils/command-queue';
export * from './utils/event';
export * from './utils/message-channel';
export { default as getEventSynthesizier } from './utils/ui-event-synthesizer';
export { default as createEventForwarder } from './utils/ui-event-forwarder';
var reNative = /\{\s*\[native code\]\s*\}/;
export function isNativeFunction(f) {
    return typeof f === 'function' && reNative.test(Function.prototype.toString.call(f));
}
export var hasNativeWebVRImplementation = typeof navigator !== 'undefined' &&
    isNativeFunction(navigator.getVRDisplays) &&
    !Object.getOwnPropertyDescriptor(navigator, "getVRDisplays");
export var suggestedWebGLContextAntialiasAttribute = hasNativeWebVRImplementation;
export function stringIdentifierFromReferenceFrame(referenceFrame) {
    var rf = referenceFrame;
    return defined(rf.id) ? rf.id : '' + rf;
}
export function jsonEquals(left, right) {
    return JSON.stringify(left) === JSON.stringify(right);
}
/**
 * Computes a 4x4 transformation matrix from a reference frame with an east-up-south axes centered at the provided origin to the provided ellipsoid's fixed reference frame. The local axes are defined as:
 * The x axis points in the local east direction.
 * The y axis points in the points in the direction of the ellipsoid surface normal which passes through the position..
 * The z axis points in the local south direction.
 */
export var eastUpSouthToFixedFrame = Transforms.localFrameToFixedFrameGenerator('east', 'up');
/**
 * Get array of ancestor reference frames of a Cesium Entity, ordered from
 * farthest ancestor to the passed frame, excluding the passed frame.
 * @param frame A Cesium Entity to get ancestor reference frames.
 * @param frames An array of reference frames of the Cesium Entity.
 */
export function getAncestorReferenceFrames(frame, result) {
    if (result === void 0) { result = []; }
    var frames = result;
    frames.length = 0;
    var f = frame;
    do {
        var position = f.position;
        f = position && position.referenceFrame;
        if (defined(f))
            frames.unshift(f);
    } while (defined(f));
    return frames;
}
var scratchAncestorCartesian = new Cartesian3;
var scratchAncestorQuaternion = new Quaternion;
/**
 * Get array of ancestor reference frames of a Cesium Entity, ordered from
 * farthest ancestor which has a valid pose to the passed frame, excluding the passed frame.
 * @param frame A Cesium Entity to get ancestor reference frames.
 * @param frames An array of reference frames of the Cesium Entity.
 */
export function getReachableAncestorReferenceFrames(frame, time, result) {
    if (result === void 0) { result = []; }
    var frames = result;
    frames.length = 0;
    var f = frame;
    var isValid = false;
    do {
        var position = f.position;
        var orientation_1 = f && f.orientation;
        f = position && position.referenceFrame;
        var hasParentFrame = defined(f);
        var pValue = hasParentFrame && position && position.getValueInReferenceFrame(time, f, scratchAncestorCartesian);
        var oValue = hasParentFrame && pValue && orientation_1 && orientation_1.getValue(time, scratchAncestorQuaternion);
        isValid = pValue && oValue;
        if (isValid)
            frames.unshift(f);
    } while (isValid);
    return frames;
}
/**
 * Gets the value of the Position property at the provided time and in the provided reference frame.
 * @param entity The entity to get position.
 * @param time The time for which to retrieve the value.
 * @param referenceFrame The desired referenceFrame of the result.
 * @param result The object to store the value into.
 * @return The modified result parameter.
 */
export function getEntityPositionInReferenceFrame(entity, time, referenceFrame, result) {
    return entity.position && entity.position.getValueInReferenceFrame(time, referenceFrame, result);
}
/**
 * Alias of getEntityPositionInReferenceFrame
 */
export var getEntityPosition = getEntityPositionInReferenceFrame;
/**
 * Get the value of the Orientation property at the provided time and in the provided reference frame.
 * @param entity The entity to get position.
 * @param time The time for which to retrieve the value.
 * @param referenceFrame The desired referenceFrame of the result.
 * @param result The object to store the value into.
 * @return The modified result parameter.
 */
export function getEntityOrientationInReferenceFrame(entity, time, referenceFrame, result) {
    var entityFrame = entity.position && entity.position.referenceFrame;
    if (!defined(entityFrame))
        return undefined;
    var orientation = entity.orientation && entity.orientation.getValue(time, result);
    if (!defined(orientation))
        return undefined;
    return OrientationProperty.convertToReferenceFrame(time, orientation, entityFrame, referenceFrame, result);
}
/**
 * Alias of getEntityOrientationInReferenceFrame
 */
export var getEntityOrientation = getEntityOrientationInReferenceFrame;
// const scratchCartesianPositionFIXED = new Cartesian3
// const scratchMatrix4 = new Matrix4
// const scratchMatrix3 = new Matrix3
//  {
//         // if no orientation is available, calculate an orientation based on position
//         const entityPositionFIXED = getEntityPositionInReferenceFrame(entity, time, ReferenceFrame.FIXED, scratchCartesianPositionFIXED)
//         if (!entityPositionFIXED) return Quaternion.clone(Quaternion.IDENTITY, result)
//         if (Cartesian3.ZERO.equals(entityPositionFIXED)) throw new Error('invalid cartographic position')
//         const transform = Transforms.eastNorthUpToFixedFrame(entityPositionFIXED, Ellipsoid.WGS84, scratchMatrix4);
//         const rotation = Matrix4.getRotation(transform, scratchMatrix3);
//         const fixedOrientation = Quaternion.fromRotationMatrix(rotation, result);
//         return OrientationProperty.convertToReferenceFrame(time, fixedOrientation, ReferenceFrame.FIXED, referenceFrame, result)
//     }
var _scratchFramesArray = [];
var _entityStateCache = {};
/**
 * Create a SerializedEntityPose from a source entity.
 * @param entity The entity which the serialized pose represents.
 * @param time The time which to retrieve the pose.
 * @param referenceFrame The reference frame to use for generating the pose.
 * If a target reference frame is not provided, the entity pose will be
 * serialized according to the furthest ancestor frame that resolves to a valid pose.
 * @return An EntityPose object with orientation, position and referenceFrame.
 */
export function getSerializedEntityState(entity, time, frame) {
    var frames = undefined;
    if (!defined(frame)) {
        frames = getReachableAncestorReferenceFrames(entity, time, _scratchFramesArray);
        frame = frames[0];
    }
    if (!defined(frame))
        return null;
    if (entity === frame)
        return null;
    var key = entity.id + '@' + (frame.id ? frame.id : frame);
    var result = _entityStateCache[key];
    if (!result)
        result = {}, _entityStateCache[key] = result;
    var p = getEntityPositionInReferenceFrame(entity, time, frame, result.p || {});
    if (!p)
        return null;
    var o = getEntityOrientationInReferenceFrame(entity, time, frame, result.o || {});
    if (!o)
        return null;
    if (p && o) {
        result.p = p;
        result.o = o;
        result.r = typeof frame === 'number' ? frame : frame.id,
            result.meta = entity['meta'];
        return result;
    }
    return null;
}
var urlParser = typeof document !== 'undefined' ? document.createElement("a") : undefined;
/**
 * If urlParser does not have a value, throw error message "resolveURL requires DOM api".
 * If inURL is undefined, throw error message "expected inURL".
 * Otherwise, assign value of inURL to urlParser.href.
 * @param inURL A URL needed to be resolved.
 * @returns A URL ready to be parsed.
 */
export function resolveURL(inURL) {
    if (!urlParser)
        throw new Error("resolveURL requires DOM api");
    if (inURL === undefined)
        throw new Error('Expected inURL');
    urlParser.href = '';
    urlParser.href = inURL;
    return urlParser.href;
}
/**
 * Parse URL to an object describing details of the URL with href, protocol,
 * hostname, port, pathname, search, hash, host.
 * @param inURL A URL needed to be parsed.
 * @return An object showing parsed URL with href, protocol,
 * hostname, port, pathname, search, hash, host.
 */
export function parseURL(inURL) {
    if (!urlParser)
        throw new Error("parseURL requires DOM api");
    if (inURL === undefined)
        throw new Error('Expected inURL');
    urlParser.href = '';
    urlParser.href = inURL;
    return {
        href: urlParser.href,
        protocol: urlParser.protocol,
        hostname: urlParser.hostname,
        port: urlParser.port,
        pathname: urlParser.pathname,
        search: urlParser.search,
        hash: urlParser.hash,
        host: urlParser.host
    };
}
export function resolveElement(elementOrSelector) {
    if (elementOrSelector instanceof HTMLElement) {
        return Promise.resolve(elementOrSelector);
    }
    else {
        return new Promise(function (resolve, reject) {
            var resolveElement = function () {
                var e = document.querySelector("" + elementOrSelector);
                if (!e)
                    reject(new Error("Unable to resolve element id " + elementOrSelector));
                else
                    resolve(e);
            };
            if (document.readyState == 'loading') {
                document.addEventListener('DOMContentLoaded', resolveElement);
            }
            else {
                resolveElement();
            }
        });
    }
}
export function decomposePerspectiveOffCenterProjectionMatrix(mat, result) {
    var m11 = mat[Matrix4.COLUMN0ROW0];
    // const m12 = mat[Matrix4.COLUMN0ROW1];
    var m22 = mat[Matrix4.COLUMN1ROW1];
    var m31 = mat[Matrix4.COLUMN2ROW0];
    var m32 = mat[Matrix4.COLUMN2ROW1];
    var m33 = mat[Matrix4.COLUMN2ROW2];
    var m43 = mat[Matrix4.COLUMN3ROW2];
    var near = result.near = m43 / (m33 - 1);
    result.far = m43 / (m33 + 1);
    result.bottom = near * (m32 - 1) / m22;
    result.top = near * (m32 + 1) / m22;
    result.left = near * (m31 - 1) / m11;
    result.right = near * (m31 + 1) / m11;
    return result;
}
var scratchPerspectiveOffCenterFrustum = new PerspectiveOffCenterFrustum;
export function decomposePerspectiveProjectionMatrix(mat, result) {
    var f = decomposePerspectiveOffCenterProjectionMatrix(mat, scratchPerspectiveOffCenterFrustum);
    var xOffset = (f.left + f.right) / 2;
    var yOffset = (f.top + f.bottom) / 2;
    var near = f.near;
    var far = f.far;
    // const left = f.left - xOffset;
    var right = f.right - xOffset;
    var top = f.top - yOffset;
    // const bottom = f.bottom - yOffset;
    var aspectRatio = right / top;
    var fovy = 2 * Math.atan(top / near);
    var fov;
    if (aspectRatio < 1) {
        fov = fovy;
    }
    else {
        fov = Math.atan(Math.tan(fovy * 0.5) * aspectRatio) * 2.0;
    }
    result.near = near;
    result.far = far;
    result.fov = fov;
    result.aspectRatio = aspectRatio;
    result.xOffset = xOffset;
    result.yOffset = yOffset;
    return result;
}
var scratchCartesian = new Cartesian3;
var scratchOrientation = new Quaternion;
/**
 * Convert an Entity's position and orientation properties to a new reference frame.
 * The properties must be constant properties.
 * @param entity The entity to convert.
 * @param time The time which to retrieve the pose up the reference chain.
 * @param referenceFrame The reference frame to convert the position and oriention to.
 * @return a boolean indicating success or failure. Will return true if the entity position/orientation
 * is already in the specified reference frame. Will return false if either property does
 * not have a `setValue` method, or if either property cannot be converted to the new frame.
 */
export function convertEntityReferenceFrame(entity, time, frame) {
    var entityPosition = entity.position;
    var entityOrientation = entity.orientation;
    if (entityPosition.referenceFrame === frame)
        return true;
    if (!entityPosition || !entityPosition.setValue ||
        !entityOrientation || !entityOrientation.setValue) {
        return false;
    }
    if (!getEntityPositionInReferenceFrame(entity, time, frame, scratchCartesian)) {
        return false;
    }
    if (!getEntityOrientationInReferenceFrame(entity, time, frame, scratchOrientation)) {
        return false;
    }
    entityPosition.setValue(scratchCartesian, frame);
    entityOrientation.setValue(scratchOrientation);
    return true;
}
export var isArgonApp = typeof navigator !== 'undefined' && typeof window !== 'undefined' &&
    navigator.userAgent.indexOf('Argon') > 0;
export var isIOS = typeof navigator !== 'undefined' && typeof window !== 'undefined' &&
    /iPad|iPhone|iPod/.test(navigator.userAgent) && !window['MSStream'];
export var isAndroid = typeof navigator !== 'undefined' && typeof window !== 'undefined' &&
    /Android/.test(navigator.userAgent) && !window['MSStream'];
export function installArgonApp() {
    if (isIOS) {
        window.location.href = "https://itunes.apple.com/us/app/argon4/id1089308600?mt=8";
    }
    else if (isAndroid) {
        window.location.href = "http://play.google.com/store/apps/details?id=edu.gatech.argon4";
    }
}
export function openInArgonApp() {
    if (isIOS) {
        window.location.href = "argon4://open?url=" + encodeURIComponent(window.location.href);
    }
    else if (isAndroid) {
        window.location.href = "intent:/#Intent;scheme=argon4;package=edu.gatech.argon4;S.url=" + encodeURIComponent(window.location.href) + ";end";
    }
}
// requestAnimationFrame / cancelAnimationFrame polyfills
var lastTime = 0;
var rAF = (typeof window !== 'undefined' && window.requestAnimationFrame) ?
    window.requestAnimationFrame.bind(window) : function (callback) {
    var currTime = performance.now();
    var timeToCall = Math.max(0, 16 - (currTime - lastTime));
    var id = setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);
    lastTime = currTime + timeToCall;
    return id;
};
var cAF = (typeof window !== 'undefined') ?
    window.cancelAnimationFrame.bind(window) : clearTimeout;
export { rAF as requestAnimationFrame, cAF as cancelAnimationFrame };
export function deprecated(alternative) {
    var didPrintWarning = false;
    var decorator = function (target, name, descriptor) {
        var original = descriptor.get || descriptor.value;
        var originalType = typeof descriptor.value === 'function' ? 'function' : 'property';
        var message = "The \"" + name + "\" " + originalType + " is deprecated. ";
        if (alternative) {
            var alternativeType = typeof target[alternative] === 'function' ? 'function' : 'property';
            message += "Please use the \"" + alternative + "\" " + alternativeType + " instead.";
        }
        var wrapped = function () {
            if (!didPrintWarning) {
                console.warn(message);
                didPrintWarning = true;
            }
            return original.apply(this, arguments);
        };
        if (descriptor.value)
            descriptor.value = wrapped;
        else
            descriptor.get = wrapped;
        return descriptor;
    };
    return decorator;
}
export var defaultTerrainProvider = new MapzenTerrariumTerrainProvider({
    url: 'https://s3.amazonaws.com/elevation-tiles-prod/terrarium/',
    requestWaterMask: true,
    requestVertexNormals: true
});
export function updateHeightFromTerrain(cartographic) {
    return Promise.resolve(sampleTerrain(defaultTerrainProvider, 15, [cartographic]).then(_valueAtFirstIndex));
}
function _valueAtFirstIndex(array) {
    return array[0];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0gsT0FBTyxFQUlQLDJCQUEyQixFQUczQixtQkFBbUIsRUFFbkIsVUFBVSxFQUNWLFVBQVUsRUFFVixPQUFPLEVBQ1AsVUFBVSxFQUVWLGFBQWEsRUFDaEIsTUFBTSx5QkFBeUIsQ0FBQTtBQUVoQyxPQUFPLEVBQ0gsOEJBQThCLEVBQ2pDLE1BQU0seUNBQXlDLENBQUE7QUFFaEQsY0FBYyx1QkFBdUIsQ0FBQztBQUN0QyxjQUFjLGVBQWUsQ0FBQztBQUM5QixjQUFjLHlCQUF5QixDQUFDO0FBQ3hDLE9BQU8sRUFBQyxPQUFPLElBQUksb0JBQW9CLEVBQUMsTUFBTSw4QkFBOEIsQ0FBQztBQUM3RSxPQUFPLEVBQUMsT0FBTyxJQUFJLG9CQUFvQixFQUFDLE1BQU0sNEJBQTRCLENBQUM7QUFFM0UsSUFBTSxRQUFRLEdBQUcsMkJBQTJCLENBQUM7QUFDN0MsTUFBTSwyQkFBMkIsQ0FBVTtJQUN2QyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssVUFBVSxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDeEYsQ0FBQztBQUVELE1BQU0sQ0FBQyxJQUFNLDRCQUE0QixHQUFHLE9BQU8sU0FBUyxLQUFLLFdBQVc7SUFDeEUsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQztJQUN6QyxDQUFDLE1BQU0sQ0FBQyx3QkFBd0IsQ0FBQyxTQUFTLEVBQUUsZUFBZSxDQUFDLENBQUM7QUFFakUsTUFBTSxDQUFDLElBQU0sdUNBQXVDLEdBQUcsNEJBQTRCLENBQUM7QUFFcEYsTUFBTSw2Q0FBNkMsY0FBZ0Q7SUFDL0YsSUFBTSxFQUFFLEdBQUcsY0FBd0IsQ0FBQztJQUNwQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVB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Q0FBQztZQUFDLFVBQVUsQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFBO1FBQ2hELElBQUk7WUFBQyxVQUFVLENBQUMsR0FBRyxHQUFHLE9BQU8sQ0FBQztRQUU5QixNQUFNLENBQUMsVUFBVSxDQUFDO0lBQ3RCLENBQUMsQ0FBQztJQUVGLE1BQU0sQ0FBQyxTQUFTLENBQUM7QUFDckIsQ0FBQztBQUVELE1BQU0sQ0FBQyxJQUFNLHNCQUFzQixHQUFHLElBQUksOEJBQThCLENBQUM7SUFDckUsR0FBRyxFQUFHLDBEQUEwRDtJQUNoRSxnQkFBZ0IsRUFBRyxJQUFJO0lBQ3ZCLG9CQUFvQixFQUFHLElBQUk7Q0FDOUIsQ0FBQyxDQUFDO0FBR0gsTUFBTSxrQ0FBa0MsWUFBMkI7SUFDL0QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLHNCQUFzQixFQUFFLEVBQUUsRUFBRSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFlLGtCQUFrQixDQUFDLENBQUMsQ0FBQztBQUM3SCxDQUFDO0FBRUQsNEJBQTRCLEtBQW9CO0lBQzVDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDcEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNlcmlhbGl6ZWRFbnRpdHlTdGF0ZSB9IGZyb20gJy4vY29tbW9uJ1xuaW1wb3J0IHtcbiAgICBkZWZpbmVkLFxuICAgIEVudGl0eSxcbiAgICBKdWxpYW5EYXRlLFxuICAgIFBlcnNwZWN0aXZlRnJ1c3R1bSxcbiAgICBQZXJzcGVjdGl2ZU9mZkNlbnRlckZydXN0dW0sXG4gICAgUG9zaXRpb25Qcm9wZXJ0eSxcbiAgICBDb25zdGFudFBvc2l0aW9uUHJvcGVydHksXG4gICAgT3JpZW50YXRpb25Qcm9wZXJ0eSxcbiAgICBDb25zdGFudFByb3BlcnR5LFxuICAgIFF1YXRlcm5pb24sXG4gICAgQ2FydGVzaWFuMyxcbiAgICBSZWZlcmVuY2VGcmFtZSxcbiAgICBNYXRyaXg0LFxuICAgIFRyYW5zZm9ybXMsXG4gICAgQ2FydG9ncmFwaGljLFxuICAgIHNhbXBsZVRlcnJhaW5cbn0gZnJvbSAnLi9jZXNpdW0vY2VzaXVtLWltcG9ydHMnXG5cbmltcG9ydCB7XG4gICAgTWFwemVuVGVycmFyaXVtVGVycmFpblByb3ZpZGVyXG59IGZyb20gJy4vY2VzaXVtL01hcHplblRlcnJhcml1bVRlcnJhaW5Qcm92aWRlcidcblxuZXhwb3J0ICogZnJvbSAnLi91dGlscy9jb21tYW5kLXF1ZXVlJztcbmV4cG9ydCAqIGZyb20gJy4vdXRpbHMvZXZlbnQnO1xuZXhwb3J0ICogZnJvbSAnLi91dGlscy9tZXNzYWdlLWNoYW5uZWwnO1xuZXhwb3J0IHtkZWZhdWx0IGFzIGdldEV2ZW50U3ludGhlc2l6aWVyfSBmcm9tICcuL3V0aWxzL3VpLWV2ZW50LXN5bnRoZXNpemVyJztcbmV4cG9ydCB7ZGVmYXVsdCBhcyBjcmVhdGVFdmVudEZvcndhcmRlcn0gZnJvbSAnLi91dGlscy91aS1ldmVudC1mb3J3YXJkZXInO1xuXG5jb25zdCByZU5hdGl2ZSA9IC9cXHtcXHMqXFxbbmF0aXZlIGNvZGVcXF1cXHMqXFx9LztcbmV4cG9ydCBmdW5jdGlvbiBpc05hdGl2ZUZ1bmN0aW9uKGY6RnVuY3Rpb24pIHtcbiAgICByZXR1cm4gdHlwZW9mIGYgPT09ICdmdW5jdGlvbicgJiYgcmVOYXRpdmUudGVzdChGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChmKSlcbn1cblxuZXhwb3J0IGNvbnN0IGhhc05hdGl2ZVdlYlZSSW1wbGVtZW50YXRpb24gPSB0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJiBcbiAgICBpc05hdGl2ZUZ1bmN0aW9uKG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzKSAmJiBcbiAgICAhT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuYXZpZ2F0b3IsIFwiZ2V0VlJEaXNwbGF5c1wiKTtcblxuZXhwb3J0IGNvbnN0IHN1Z2dlc3RlZFdlYkdMQ29udGV4dEFudGlhbGlhc0F0dHJpYnV0ZSA9IGhhc05hdGl2ZVdlYlZSSW1wbGVtZW50YXRpb247XG5cbmV4cG9ydCBmdW5jdGlvbiBzdHJpbmdJZGVudGlmaWVyRnJvbVJlZmVyZW5jZUZyYW1lKHJlZmVyZW5jZUZyYW1lOiBzdHJpbmcgfCBSZWZlcmVuY2VGcmFtZSB8IEVudGl0eSk6IHN0cmluZyB7XG4gICAgY29uc3QgcmYgPSByZWZlcmVuY2VGcmFtZSBhcyBFbnRpdHk7XG4gICAgcmV0dXJuIGRlZmluZWQocmYuaWQpID8gcmYuaWQgOiAnJyArIHJmO1xufVxuXG5cbmV4cG9ydCBmdW5jdGlvbiBqc29uRXF1YWxzKGxlZnQ/Ont9LCByaWdodD86e30pIHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobGVmdCkgPT09IEpTT04uc3RyaW5naWZ5KHJpZ2h0KTtcbn1cblxuLyoqXG4gKiBDb21wdXRlcyBhIDR4NCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggZnJvbSBhIHJlZmVyZW5jZSBmcmFtZSB3aXRoIGFuIGVhc3QtdXAtc291dGggYXhlcyBjZW50ZXJlZCBhdCB0aGUgcHJvdmlkZWQgb3JpZ2luIHRvIHRoZSBwcm92aWRlZCBlbGxpcHNvaWQncyBmaXhlZCByZWZlcmVuY2UgZnJhbWUuIFRoZSBsb2NhbCBheGVzIGFyZSBkZWZpbmVkIGFzOlxuICogVGhlIHggYXhpcyBwb2ludHMgaW4gdGhlIGxvY2FsIGVhc3QgZGlyZWN0aW9uLlxuICogVGhlIHkgYXhpcyBwb2ludHMgaW4gdGhlIHBvaW50cyBpbiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBlbGxpcHNvaWQgc3VyZmFjZSBub3JtYWwgd2hpY2ggcGFzc2VzIHRocm91Z2ggdGhlIHBvc2l0aW9uLi5cbiAqIFRoZSB6IGF4aXMgcG9pbnRzIGluIHRoZSBsb2NhbCBzb3V0aCBkaXJlY3Rpb24uXG4gKi9cbmV4cG9ydCBjb25zdCBlYXN0VXBTb3V0aFRvRml4ZWRGcmFtZSA9IFRyYW5zZm9ybXMubG9jYWxGcmFtZVRvRml4ZWRGcmFtZUdlbmVyYXRvcignZWFzdCcsJ3VwJyk7XG5cbi8qKlxuICogR2V0IGFycmF5IG9mIGFuY2VzdG9yIHJlZmVyZW5jZSBmcmFtZXMgb2YgYSBDZXNpdW0gRW50aXR5LCBvcmRlcmVkIGZyb20gXG4gKiBmYXJ0aGVzdCBhbmNlc3RvciB0byB0aGUgcGFzc2VkIGZyYW1lLCBleGNsdWRpbmcgdGhlIHBhc3NlZCBmcmFtZS5cbiAqIEBwYXJhbSBmcmFtZSBBIENlc2l1bSBFbnRpdHkgdG8gZ2V0IGFuY2VzdG9yIHJlZmVyZW5jZSBmcmFtZXMuXG4gKiBAcGFyYW0gZnJhbWVzIEFuIGFycmF5IG9mIHJlZmVyZW5jZSBmcmFtZXMgb2YgdGhlIENlc2l1bSBFbnRpdHkuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBbmNlc3RvclJlZmVyZW5jZUZyYW1lcyhmcmFtZTogRW50aXR5LCByZXN1bHQ9W10pIHtcbiAgICBjb25zdCBmcmFtZXM6IEFycmF5PEVudGl0eSB8IFJlZmVyZW5jZUZyYW1lPiA9IHJlc3VsdDtcbiAgICBmcmFtZXMubGVuZ3RoID0gMDtcbiAgICBsZXQgZjogRW50aXR5IHwgUmVmZXJlbmNlRnJhbWUgfCB1bmRlZmluZWQgPSBmcmFtZTtcbiAgICBkbyB7XG4gICAgICAgIGxldCBwb3NpdGlvbjogUG9zaXRpb25Qcm9wZXJ0eSB8IHVuZGVmaW5lZCA9IChmIGFzIEVudGl0eSkucG9zaXRpb247XG4gICAgICAgIGYgPSBwb3NpdGlvbiAmJiBwb3NpdGlvbi5yZWZlcmVuY2VGcmFtZTtcbiAgICAgICAgaWYgKGRlZmluZWQoZikpIGZyYW1lcy51bnNoaWZ0KGYpO1xuICAgIH0gd2hpbGUgKGRlZmluZWQoZikpIFxuICAgIHJldHVybiBmcmFtZXNcbn1cblxuXG52YXIgc2NyYXRjaEFuY2VzdG9yQ2FydGVzaWFuID0gbmV3IENhcnRlc2lhbjM7XG52YXIgc2NyYXRjaEFuY2VzdG9yUXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uO1xuLyoqXG4gKiBHZXQgYXJyYXkgb2YgYW5jZXN0b3IgcmVmZXJlbmNlIGZyYW1lcyBvZiBhIENlc2l1bSBFbnRpdHksIG9yZGVyZWQgZnJvbSBcbiAqIGZhcnRoZXN0IGFuY2VzdG9yIHdoaWNoIGhhcyBhIHZhbGlkIHBvc2UgdG8gdGhlIHBhc3NlZCBmcmFtZSwgZXhjbHVkaW5nIHRoZSBwYXNzZWQgZnJhbWUuXG4gKiBAcGFyYW0gZnJhbWUgQSBDZXNpdW0gRW50aXR5IHRvIGdldCBhbmNlc3RvciByZWZlcmVuY2UgZnJhbWVzLlxuICogQHBhcmFtIGZyYW1lcyBBbiBhcnJheSBvZiByZWZlcmVuY2UgZnJhbWVzIG9mIHRoZSBDZXNpdW0gRW50aXR5LlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVhY2hhYmxlQW5jZXN0b3JSZWZlcmVuY2VGcmFtZXMoZnJhbWU6IEVudGl0eSwgdGltZTpKdWxpYW5EYXRlLCByZXN1bHQ9W10pIHtcbiAgICBjb25zdCBmcmFtZXM6IEFycmF5PEVudGl0eSB8IFJlZmVyZW5jZUZyYW1lPiA9IHJlc3VsdDtcbiAgICBmcmFtZXMubGVuZ3RoID0gMDtcbiAgICBsZXQgZjogRW50aXR5IHwgUmVmZXJlbmNlRnJhbWUgfCB1bmRlZmluZWQgPSBmcmFtZTtcbiAgICBsZXQgaXNWYWxpZCA9IGZhbHNlO1xuICAgIGRvIHtcbiAgICAgICAgY29uc3QgcG9zaXRpb246IFBvc2l0aW9uUHJvcGVydHkgfCB1bmRlZmluZWQgPSAoZiBhcyBFbnRpdHkpLnBvc2l0aW9uO1xuICAgICAgICBjb25zdCBvcmllbnRhdGlvbiA9IGYgJiYgKGYgYXMgRW50aXR5KS5vcmllbnRhdGlvbjtcblxuICAgICAgICBmID0gcG9zaXRpb24gJiYgcG9zaXRpb24ucmVmZXJlbmNlRnJhbWU7XG4gICAgICAgIGNvbnN0IGhhc1BhcmVudEZyYW1lID0gZGVmaW5lZChmKTtcblxuICAgICAgICBjb25zdCBwVmFsdWUgPSBoYXNQYXJlbnRGcmFtZSAmJiBwb3NpdGlvbiAmJiBwb3NpdGlvbi5nZXRWYWx1ZUluUmVmZXJlbmNlRnJhbWUodGltZSwgZiEsIHNjcmF0Y2hBbmNlc3RvckNhcnRlc2lhbik7XG4gICAgICAgIGNvbnN0IG9WYWx1ZSA9IGhhc1BhcmVudEZyYW1lICYmIHBWYWx1ZSAmJiBvcmllbnRhdGlvbiAmJiBvcmllbnRhdGlvbi5nZXRWYWx1ZSh0aW1lLCBzY3JhdGNoQW5jZXN0b3JRdWF0ZXJuaW9uKTtcbiAgICAgICAgaXNWYWxpZCA9IHBWYWx1ZSAmJiBvVmFsdWU7XG4gICAgICAgIGlmIChpc1ZhbGlkKSBmcmFtZXMudW5zaGlmdChmISk7XG4gICAgfSB3aGlsZSAoaXNWYWxpZCkgXG4gICAgcmV0dXJuIGZyYW1lc1xufVxuXG4vKipcbiAqIEdldHMgdGhlIHZhbHVlIG9mIHRoZSBQb3NpdGlvbiBwcm9wZXJ0eSBhdCB0aGUgcHJvdmlkZWQgdGltZSBhbmQgaW4gdGhlIHByb3ZpZGVkIHJlZmVyZW5jZSBmcmFtZS5cbiAqIEBwYXJhbSBlbnRpdHkgVGhlIGVudGl0eSB0byBnZXQgcG9zaXRpb24uIFxuICogQHBhcmFtIHRpbWUgVGhlIHRpbWUgZm9yIHdoaWNoIHRvIHJldHJpZXZlIHRoZSB2YWx1ZS5cbiAqIEBwYXJhbSByZWZlcmVuY2VGcmFtZSBUaGUgZGVzaXJlZCByZWZlcmVuY2VGcmFtZSBvZiB0aGUgcmVzdWx0LlxuICogQHBhcmFtIHJlc3VsdCBUaGUgb2JqZWN0IHRvIHN0b3JlIHRoZSB2YWx1ZSBpbnRvLlxuICogQHJldHVybiBUaGUgbW9kaWZpZWQgcmVzdWx0IHBhcmFtZXRlci5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEVudGl0eVBvc2l0aW9uSW5SZWZlcmVuY2VGcmFtZShcbiAgICBlbnRpdHk6IEVudGl0eSxcbiAgICB0aW1lOiBKdWxpYW5EYXRlLFxuICAgIHJlZmVyZW5jZUZyYW1lOiBFbnRpdHkgfCBSZWZlcmVuY2VGcmFtZSxcbiAgICByZXN1bHQ6IENhcnRlc2lhbjMpOiBDYXJ0ZXNpYW4zIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gZW50aXR5LnBvc2l0aW9uICYmIGVudGl0eS5wb3NpdGlvbi5nZXRWYWx1ZUluUmVmZXJlbmNlRnJhbWUodGltZSwgcmVmZXJlbmNlRnJhbWUsIHJlc3VsdClcbn1cblxuLyoqXG4gKiBBbGlhcyBvZiBnZXRFbnRpdHlQb3NpdGlvbkluUmVmZXJlbmNlRnJhbWVcbiAqL1xuZXhwb3J0IGNvbnN0IGdldEVudGl0eVBvc2l0aW9uID0gZ2V0RW50aXR5UG9zaXRpb25JblJlZmVyZW5jZUZyYW1lO1xuXG4vKipcbiAqIEdldCB0aGUgdmFsdWUgb2YgdGhlIE9yaWVudGF0aW9uIHByb3BlcnR5IGF0IHRoZSBwcm92aWRlZCB0aW1lIGFuZCBpbiB0aGUgcHJvdmlkZWQgcmVmZXJlbmNlIGZyYW1lLlxuICogQHBhcmFtIGVudGl0eSBUaGUgZW50aXR5IHRvIGdldCBwb3NpdGlvbi4gXG4gKiBAcGFyYW0gdGltZSBUaGUgdGltZSBmb3Igd2hpY2ggdG8gcmV0cmlldmUgdGhlIHZhbHVlLlxuICogQHBhcmFtIHJlZmVyZW5jZUZyYW1lIFRoZSBkZXNpcmVkIHJlZmVyZW5jZUZyYW1lIG9mIHRoZSByZXN1bHQuXG4gKiBAcGFyYW0gcmVzdWx0IFRoZSBvYmplY3QgdG8gc3RvcmUgdGhlIHZhbHVlIGludG8uXG4gKiBAcmV0dXJuIFRoZSBtb2RpZmllZCByZXN1bHQgcGFyYW1ldGVyLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RW50aXR5T3JpZW50YXRpb25JblJlZmVyZW5jZUZyYW1lKFxuICAgIGVudGl0eTogRW50aXR5LFxuICAgIHRpbWU6IEp1bGlhbkRhdGUsXG4gICAgcmVmZXJlbmNlRnJhbWU6IFJlZmVyZW5jZUZyYW1lIHwgRW50aXR5LFxuICAgIHJlc3VsdDogUXVhdGVybmlvbik6IFF1YXRlcm5pb24gfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGVudGl0eUZyYW1lID0gZW50aXR5LnBvc2l0aW9uICYmIGVudGl0eS5wb3NpdGlvbi5yZWZlcmVuY2VGcmFtZVxuICAgIGlmICghZGVmaW5lZChlbnRpdHlGcmFtZSkpIHJldHVybiB1bmRlZmluZWRcbiAgICBsZXQgb3JpZW50YXRpb246IFF1YXRlcm5pb24gPSBlbnRpdHkub3JpZW50YXRpb24gJiYgZW50aXR5Lm9yaWVudGF0aW9uLmdldFZhbHVlKHRpbWUsIHJlc3VsdClcbiAgICBpZiAoIWRlZmluZWQob3JpZW50YXRpb24pKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgIHJldHVybiBPcmllbnRhdGlvblByb3BlcnR5LmNvbnZlcnRUb1JlZmVyZW5jZUZyYW1lKHRpbWUsIG9yaWVudGF0aW9uLCBlbnRpdHlGcmFtZSwgcmVmZXJlbmNlRnJhbWUsIHJlc3VsdClcbn1cblxuLyoqXG4gKiBBbGlhcyBvZiBnZXRFbnRpdHlPcmllbnRhdGlvbkluUmVmZXJlbmNlRnJhbWVcbiAqL1xuZXhwb3J0IGNvbnN0IGdldEVudGl0eU9yaWVudGF0aW9uID0gZ2V0RW50aXR5T3JpZW50YXRpb25JblJlZmVyZW5jZUZyYW1lO1xuXG5cblxuLy8gY29uc3Qgc2NyYXRjaENhcnRlc2lhblBvc2l0aW9uRklYRUQgPSBuZXcgQ2FydGVzaWFuM1xuLy8gY29uc3Qgc2NyYXRjaE1hdHJpeDQgPSBuZXcgTWF0cml4NFxuLy8gY29uc3Qgc2NyYXRjaE1hdHJpeDMgPSBuZXcgTWF0cml4M1xuLy8gIHtcbi8vICAgICAgICAgLy8gaWYgbm8gb3JpZW50YXRpb24gaXMgYXZhaWxhYmxlLCBjYWxjdWxhdGUgYW4gb3JpZW50YXRpb24gYmFzZWQgb24gcG9zaXRpb25cbi8vICAgICAgICAgY29uc3QgZW50aXR5UG9zaXRpb25GSVhFRCA9IGdldEVudGl0eVBvc2l0aW9uSW5SZWZlcmVuY2VGcmFtZShlbnRpdHksIHRpbWUsIFJlZmVyZW5jZUZyYW1lLkZJWEVELCBzY3JhdGNoQ2FydGVzaWFuUG9zaXRpb25GSVhFRClcbi8vICAgICAgICAgaWYgKCFlbnRpdHlQb3NpdGlvbkZJWEVEKSByZXR1cm4gUXVhdGVybmlvbi5jbG9uZShRdWF0ZXJuaW9uLklERU5USVRZLCByZXN1bHQpXG4vLyAgICAgICAgIGlmIChDYXJ0ZXNpYW4zLlpFUk8uZXF1YWxzKGVudGl0eVBvc2l0aW9uRklYRUQpKSB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgY2FydG9ncmFwaGljIHBvc2l0aW9uJylcbi8vICAgICAgICAgY29uc3QgdHJhbnNmb3JtID0gVHJhbnNmb3Jtcy5lYXN0Tm9ydGhVcFRvRml4ZWRGcmFtZShlbnRpdHlQb3NpdGlvbkZJWEVELCBFbGxpcHNvaWQuV0dTODQsIHNjcmF0Y2hNYXRyaXg0KTtcbi8vICAgICAgICAgY29uc3Qgcm90YXRpb24gPSBNYXRyaXg0LmdldFJvdGF0aW9uKHRyYW5zZm9ybSwgc2NyYXRjaE1hdHJpeDMpO1xuLy8gICAgICAgICBjb25zdCBmaXhlZE9yaWVudGF0aW9uID0gUXVhdGVybmlvbi5mcm9tUm90YXRpb25NYXRyaXgocm90YXRpb24sIHJlc3VsdCk7XG4vLyAgICAgICAgIHJldHVybiBPcmllbnRhdGlvblByb3BlcnR5LmNvbnZlcnRUb1JlZmVyZW5jZUZyYW1lKHRpbWUsIGZpeGVkT3JpZW50YXRpb24sIFJlZmVyZW5jZUZyYW1lLkZJWEVELCByZWZlcmVuY2VGcmFtZSwgcmVzdWx0KVxuLy8gICAgIH1cblxuY29uc3QgX3NjcmF0Y2hGcmFtZXNBcnJheSA9IFtdO1xuY29uc3QgX2VudGl0eVN0YXRlQ2FjaGU6e1trZXk6c3RyaW5nXTpTZXJpYWxpemVkRW50aXR5U3RhdGV9ID0ge307XG5cbi8qKlxuICogQ3JlYXRlIGEgU2VyaWFsaXplZEVudGl0eVBvc2UgZnJvbSBhIHNvdXJjZSBlbnRpdHkuIFxuICogQHBhcmFtIGVudGl0eSBUaGUgZW50aXR5IHdoaWNoIHRoZSBzZXJpYWxpemVkIHBvc2UgcmVwcmVzZW50cy4gXG4gKiBAcGFyYW0gdGltZSBUaGUgdGltZSB3aGljaCB0byByZXRyaWV2ZSB0aGUgcG9zZS5cbiAqIEBwYXJhbSByZWZlcmVuY2VGcmFtZSBUaGUgcmVmZXJlbmNlIGZyYW1lIHRvIHVzZSBmb3IgZ2VuZXJhdGluZyB0aGUgcG9zZS4gXG4gKiBJZiBhIHRhcmdldCByZWZlcmVuY2UgZnJhbWUgaXMgbm90IHByb3ZpZGVkLCB0aGUgZW50aXR5IHBvc2Ugd2lsbCBiZSBcbiAqIHNlcmlhbGl6ZWQgYWNjb3JkaW5nIHRvIHRoZSBmdXJ0aGVzdCBhbmNlc3RvciBmcmFtZSB0aGF0IHJlc29sdmVzIHRvIGEgdmFsaWQgcG9zZS5cbiAqIEByZXR1cm4gQW4gRW50aXR5UG9zZSBvYmplY3Qgd2l0aCBvcmllbnRhdGlvbiwgcG9zaXRpb24gYW5kIHJlZmVyZW5jZUZyYW1lLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2VyaWFsaXplZEVudGl0eVN0YXRlKGVudGl0eTogRW50aXR5LCB0aW1lOiBKdWxpYW5EYXRlLCBmcmFtZT86IFJlZmVyZW5jZUZyYW1lIHwgRW50aXR5KTogU2VyaWFsaXplZEVudGl0eVN0YXRlIHwgbnVsbCB7XG4gICAgbGV0IGZyYW1lczooUmVmZXJlbmNlRnJhbWV8RW50aXR5fHVuZGVmaW5lZClbXXx1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG4gICAgXG4gICAgaWYgKCFkZWZpbmVkKGZyYW1lKSkge1xuICAgICAgICBmcmFtZXMgPSBnZXRSZWFjaGFibGVBbmNlc3RvclJlZmVyZW5jZUZyYW1lcyhlbnRpdHksIHRpbWUsIF9zY3JhdGNoRnJhbWVzQXJyYXkpO1xuICAgICAgICBmcmFtZSA9IGZyYW1lc1swXTtcbiAgICB9XG5cbiAgICBpZiAoIWRlZmluZWQoZnJhbWUpKSByZXR1cm4gbnVsbDtcbiAgICBpZiAoZW50aXR5ID09PSBmcmFtZSkgcmV0dXJuIG51bGw7XG5cbiAgICBjb25zdCBrZXkgPSBlbnRpdHkuaWQgKyAnQCcgKyAoKGZyYW1lIGFzIEVudGl0eSkuaWQgPyAoZnJhbWUgYXMgRW50aXR5KS5pZCA6IGZyYW1lKTtcbiAgICBsZXQgcmVzdWx0ID0gX2VudGl0eVN0YXRlQ2FjaGVba2V5XTtcbiAgICBpZiAoIXJlc3VsdCkgcmVzdWx0ID0gPFNlcmlhbGl6ZWRFbnRpdHlTdGF0ZT4ge30sIF9lbnRpdHlTdGF0ZUNhY2hlW2tleV0gPSByZXN1bHQ7XG5cbiAgICBjb25zdCBwID0gZ2V0RW50aXR5UG9zaXRpb25JblJlZmVyZW5jZUZyYW1lKGVudGl0eSwgdGltZSwgZnJhbWUsIHJlc3VsdC5wIHx8IHt9IGFzIENhcnRlc2lhbjMpO1xuICAgIGlmICghcCkgcmV0dXJuIG51bGw7XG4gICAgY29uc3QgbyA9IGdldEVudGl0eU9yaWVudGF0aW9uSW5SZWZlcmVuY2VGcmFtZShlbnRpdHksIHRpbWUsIGZyYW1lLCByZXN1bHQubyB8fCB7fSBhcyBRdWF0ZXJuaW9uKTtcbiAgICBpZiAoIW8pIHJldHVybiBudWxsO1xuXG4gICAgaWYgKHAgJiYgbykge1xuICAgICAgICByZXN1bHQucCA9IHA7XG4gICAgICAgIHJlc3VsdC5vID0gbztcbiAgICAgICAgcmVzdWx0LnIgPSB0eXBlb2YgZnJhbWUgPT09ICdudW1iZXInID8gZnJhbWUgOiBmcmFtZS5pZCxcbiAgICAgICAgcmVzdWx0Lm1ldGEgPSBlbnRpdHlbJ21ldGEnXTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIG51bGw7XG59XG5cblxuY29uc3QgdXJsUGFyc2VyID0gdHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJyA/IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpIDogdW5kZWZpbmVkXG5cbi8qKlxuICogSWYgdXJsUGFyc2VyIGRvZXMgbm90IGhhdmUgYSB2YWx1ZSwgdGhyb3cgZXJyb3IgbWVzc2FnZSBcInJlc29sdmVVUkwgcmVxdWlyZXMgRE9NIGFwaVwiLlxuICogSWYgaW5VUkwgaXMgdW5kZWZpbmVkLCB0aHJvdyBlcnJvciBtZXNzYWdlIFwiZXhwZWN0ZWQgaW5VUkxcIi5cbiAqIE90aGVyd2lzZSwgYXNzaWduIHZhbHVlIG9mIGluVVJMIHRvIHVybFBhcnNlci5ocmVmLlxuICogQHBhcmFtIGluVVJMIEEgVVJMIG5lZWRlZCB0byBiZSByZXNvbHZlZC5cbiAqIEByZXR1cm5zIEEgVVJMIHJlYWR5IHRvIGJlIHBhcnNlZC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVVUkwoaW5VUkw6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKCF1cmxQYXJzZXIpIHRocm93IG5ldyBFcnJvcihcInJlc29sdmVVUkwgcmVxdWlyZXMgRE9NIGFwaVwiKTtcbiAgICBpZiAoaW5VUkwgPT09IHVuZGVmaW5lZCkgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCBpblVSTCcpXG4gICAgdXJsUGFyc2VyLmhyZWYgPSAnJztcbiAgICB1cmxQYXJzZXIuaHJlZiA9IGluVVJMXG4gICAgcmV0dXJuIHVybFBhcnNlci5ocmVmXG59XG5cblxuLyoqXG4gKiBQYXJzZSBVUkwgdG8gYW4gb2JqZWN0IGRlc2NyaWJpbmcgZGV0YWlscyBvZiB0aGUgVVJMIHdpdGggaHJlZiwgcHJvdG9jb2wsIFxuICogaG9zdG5hbWUsIHBvcnQsIHBhdGhuYW1lLCBzZWFyY2gsIGhhc2gsIGhvc3QuXG4gKiBAcGFyYW0gaW5VUkwgQSBVUkwgbmVlZGVkIHRvIGJlIHBhcnNlZC5cbiAqIEByZXR1cm4gQW4gb2JqZWN0IHNob3dpbmcgcGFyc2VkIFVSTCB3aXRoIGhyZWYsIHByb3RvY29sLCBcbiAqIGhvc3RuYW1lLCBwb3J0LCBwYXRobmFtZSwgc2VhcmNoLCBoYXNoLCBob3N0LlxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VVUkwoaW5VUkw6IHN0cmluZykge1xuICAgIGlmICghdXJsUGFyc2VyKSB0aHJvdyBuZXcgRXJyb3IoXCJwYXJzZVVSTCByZXF1aXJlcyBET00gYXBpXCIpO1xuICAgIGlmIChpblVSTCA9PT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIGluVVJMJylcbiAgICB1cmxQYXJzZXIuaHJlZiA9ICcnXG4gICAgdXJsUGFyc2VyLmhyZWYgPSBpblVSTFxuICAgIHJldHVybiB7XG4gICAgICAgIGhyZWY6IHVybFBhcnNlci5ocmVmLFxuICAgICAgICBwcm90b2NvbDogdXJsUGFyc2VyLnByb3RvY29sLFxuICAgICAgICBob3N0bmFtZTogdXJsUGFyc2VyLmhvc3RuYW1lLFxuICAgICAgICBwb3J0OiB1cmxQYXJzZXIucG9ydCxcbiAgICAgICAgcGF0aG5hbWU6IHVybFBhcnNlci5wYXRobmFtZSxcbiAgICAgICAgc2VhcmNoOiB1cmxQYXJzZXIuc2VhcmNoLFxuICAgICAgICBoYXNoOiB1cmxQYXJzZXIuaGFzaCxcbiAgICAgICAgaG9zdDogdXJsUGFyc2VyLmhvc3RcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXNvbHZlRWxlbWVudChlbGVtZW50T3JTZWxlY3RvcjpzdHJpbmd8SFRNTEVsZW1lbnQpIHtcbiAgICBpZiAoZWxlbWVudE9yU2VsZWN0b3IgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGVsZW1lbnRPclNlbGVjdG9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk9PntcbiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVFbGVtZW50ID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBlID0gPEhUTUxEaXZFbGVtZW50PmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCR7ZWxlbWVudE9yU2VsZWN0b3J9YCk7XG4gICAgICAgICAgICAgICAgaWYgKCFlKSByZWplY3QobmV3IEVycm9yKGBVbmFibGUgdG8gcmVzb2x2ZSBlbGVtZW50IGlkICR7ZWxlbWVudE9yU2VsZWN0b3J9YCkpXG4gICAgICAgICAgICAgICAgZWxzZSByZXNvbHZlKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT0gJ2xvYWRpbmcnKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIHJlc29sdmVFbGVtZW50KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZUVsZW1lbnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWNvbXBvc2VQZXJzcGVjdGl2ZU9mZkNlbnRlclByb2plY3Rpb25NYXRyaXgobWF0OiBNYXRyaXg0LCByZXN1bHQ6IFBlcnNwZWN0aXZlT2ZmQ2VudGVyRnJ1c3R1bSkge1xuICAgIGNvbnN0IG0xMSA9IG1hdFtNYXRyaXg0LkNPTFVNTjBST1cwXTtcbiAgICAvLyBjb25zdCBtMTIgPSBtYXRbTWF0cml4NC5DT0xVTU4wUk9XMV07XG4gICAgY29uc3QgbTIyID0gbWF0W01hdHJpeDQuQ09MVU1OMVJPVzFdO1xuICAgIGNvbnN0IG0zMSA9IG1hdFtNYXRyaXg0LkNPTFVNTjJST1cwXTtcbiAgICBjb25zdCBtMzIgPSBtYXRbTWF0cml4NC5DT0xVTU4yUk9XMV07XG4gICAgY29uc3QgbTMzID0gbWF0W01hdHJpeDQuQ09MVU1OMlJPVzJdO1xuICAgIGNvbnN0IG00MyA9IG1hdFtNYXRyaXg0LkNPTFVNTjNST1cyXTtcblxuICAgIGNvbnN0IG5lYXIgPSByZXN1bHQubmVhciA9IG00MyAvIChtMzMgLSAxKTtcbiAgICByZXN1bHQuZmFyID0gbTQzIC8gKG0zMyArIDEpO1xuICAgIHJlc3VsdC5ib3R0b20gPSBuZWFyICogKG0zMiAtIDEpIC8gbTIyO1xuICAgIHJlc3VsdC50b3AgPSBuZWFyICogKG0zMiArIDEpIC8gbTIyO1xuICAgIHJlc3VsdC5sZWZ0ID0gbmVhciAqIChtMzEgLSAxKSAvIG0xMTtcbiAgICByZXN1bHQucmlnaHQgPSBuZWFyICogKG0zMSArIDEpIC8gbTExO1xuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbmNvbnN0IHNjcmF0Y2hQZXJzcGVjdGl2ZU9mZkNlbnRlckZydXN0dW0gPSBuZXcgUGVyc3BlY3RpdmVPZmZDZW50ZXJGcnVzdHVtO1xuXG5leHBvcnQgZnVuY3Rpb24gZGVjb21wb3NlUGVyc3BlY3RpdmVQcm9qZWN0aW9uTWF0cml4KG1hdDogTWF0cml4NCwgcmVzdWx0OiBQZXJzcGVjdGl2ZUZydXN0dW0pIHtcbiAgICBjb25zdCBmID0gZGVjb21wb3NlUGVyc3BlY3RpdmVPZmZDZW50ZXJQcm9qZWN0aW9uTWF0cml4KG1hdCwgc2NyYXRjaFBlcnNwZWN0aXZlT2ZmQ2VudGVyRnJ1c3R1bSk7XG5cbiAgICBjb25zdCB4T2Zmc2V0ID0gKGYubGVmdCArIGYucmlnaHQpIC8gMjtcbiAgICBjb25zdCB5T2Zmc2V0ID0gKGYudG9wICsgZi5ib3R0b20pIC8gMjtcbiAgICBjb25zdCBuZWFyID0gZi5uZWFyO1xuICAgIGNvbnN0IGZhciA9IGYuZmFyO1xuICAgIC8vIGNvbnN0IGxlZnQgPSBmLmxlZnQgLSB4T2Zmc2V0O1xuICAgIGNvbnN0IHJpZ2h0ID0gZi5yaWdodCAtIHhPZmZzZXQ7XG4gICAgY29uc3QgdG9wID0gZi50b3AgLSB5T2Zmc2V0O1xuICAgIC8vIGNvbnN0IGJvdHRvbSA9IGYuYm90dG9tIC0geU9mZnNldDtcbiAgICBjb25zdCBhc3BlY3RSYXRpbyA9IHJpZ2h0IC8gdG9wO1xuXG4gICAgY29uc3QgZm92eSA9IDIgKiBNYXRoLmF0YW4odG9wIC8gbmVhcik7XG5cbiAgICBsZXQgZm92O1xuICAgIGlmIChhc3BlY3RSYXRpbyA8IDEpIHtcbiAgICAgICAgZm92ID0gZm92eTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBmb3YgPSBNYXRoLmF0YW4oTWF0aC50YW4oZm92eSAqIDAuNSkgKiBhc3BlY3RSYXRpbykgKiAyLjBcbiAgICB9XG5cbiAgICByZXN1bHQubmVhciA9IG5lYXI7XG4gICAgcmVzdWx0LmZhciA9IGZhcjtcbiAgICByZXN1bHQuZm92ID0gZm92O1xuICAgIHJlc3VsdC5hc3BlY3RSYXRpbyA9IGFzcGVjdFJhdGlvO1xuICAgIHJlc3VsdC54T2Zmc2V0ID0geE9mZnNldDtcbiAgICByZXN1bHQueU9mZnNldCA9IHlPZmZzZXQ7XG5cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuXG52YXIgc2NyYXRjaENhcnRlc2lhbiA9IG5ldyBDYXJ0ZXNpYW4zO1xudmFyIHNjcmF0Y2hPcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uO1xuLyoqXG4gKiBDb252ZXJ0IGFuIEVudGl0eSdzIHBvc2l0aW9uIGFuZCBvcmllbnRhdGlvbiBwcm9wZXJ0aWVzIHRvIGEgbmV3IHJlZmVyZW5jZSBmcmFtZS4gIFxuICogVGhlIHByb3BlcnRpZXMgbXVzdCBiZSBjb25zdGFudCBwcm9wZXJ0aWVzLlxuICogQHBhcmFtIGVudGl0eSBUaGUgZW50aXR5IHRvIGNvbnZlcnQuIFxuICogQHBhcmFtIHRpbWUgVGhlIHRpbWUgd2hpY2ggdG8gcmV0cmlldmUgdGhlIHBvc2UgdXAgdGhlIHJlZmVyZW5jZSBjaGFpbi5cbiAqIEBwYXJhbSByZWZlcmVuY2VGcmFtZSBUaGUgcmVmZXJlbmNlIGZyYW1lIHRvIGNvbnZlcnQgdGhlIHBvc2l0aW9uIGFuZCBvcmllbnRpb24gdG8uIFxuICogQHJldHVybiBhIGJvb2xlYW4gaW5kaWNhdGluZyBzdWNjZXNzIG9yIGZhaWx1cmUuIFdpbGwgcmV0dXJuIHRydWUgaWYgdGhlIGVudGl0eSBwb3NpdGlvbi9vcmllbnRhdGlvbiBcbiAqIGlzIGFscmVhZHkgaW4gdGhlIHNwZWNpZmllZCByZWZlcmVuY2UgZnJhbWUuIFdpbGwgcmV0dXJuIGZhbHNlIGlmIGVpdGhlciBwcm9wZXJ0eSBkb2VzXG4gKiBub3QgaGF2ZSBhIGBzZXRWYWx1ZWAgbWV0aG9kLCBvciBpZiBlaXRoZXIgcHJvcGVydHkgY2Fubm90IGJlIGNvbnZlcnRlZCB0byB0aGUgbmV3IGZyYW1lLlxuICovXG5leHBvcnQgZnVuY3Rpb24gY29udmVydEVudGl0eVJlZmVyZW5jZUZyYW1lKGVudGl0eTpFbnRpdHksIHRpbWU6SnVsaWFuRGF0ZSwgZnJhbWU6UmVmZXJlbmNlRnJhbWV8RW50aXR5KSB7XG4gICAgY29uc3QgZW50aXR5UG9zaXRpb24gPSBlbnRpdHkucG9zaXRpb24gYXMgQ29uc3RhbnRQb3NpdGlvblByb3BlcnR5O1xuICAgIGNvbnN0IGVudGl0eU9yaWVudGF0aW9uID0gZW50aXR5Lm9yaWVudGF0aW9uIGFzIENvbnN0YW50UHJvcGVydHk7XG4gICAgaWYgKGVudGl0eVBvc2l0aW9uLnJlZmVyZW5jZUZyYW1lID09PSBmcmFtZSkgcmV0dXJuIHRydWU7XG4gICAgaWYgKCFlbnRpdHlQb3NpdGlvbiB8fCAhZW50aXR5UG9zaXRpb24uc2V0VmFsdWUgfHxcbiAgICAgICAgIWVudGl0eU9yaWVudGF0aW9uIHx8ICFlbnRpdHlPcmllbnRhdGlvbi5zZXRWYWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIWdldEVudGl0eVBvc2l0aW9uSW5SZWZlcmVuY2VGcmFtZShcbiAgICAgICAgZW50aXR5LFxuICAgICAgICB0aW1lLFxuICAgICAgICBmcmFtZSxcbiAgICAgICAgc2NyYXRjaENhcnRlc2lhbikpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKCFnZXRFbnRpdHlPcmllbnRhdGlvbkluUmVmZXJlbmNlRnJhbWUoXG4gICAgICAgIGVudGl0eSxcbiAgICAgICAgdGltZSxcbiAgICAgICAgZnJhbWUsXG4gICAgICAgIHNjcmF0Y2hPcmllbnRhdGlvbikpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTsgICAgICAgIFxuICAgIH1cbiAgICBlbnRpdHlQb3NpdGlvbi5zZXRWYWx1ZShzY3JhdGNoQ2FydGVzaWFuLCBmcmFtZSk7XG4gICAgZW50aXR5T3JpZW50YXRpb24uc2V0VmFsdWUoc2NyYXRjaE9yaWVudGF0aW9uKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IGNvbnN0IGlzQXJnb25BcHAgPSB0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJiAgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0FyZ29uJykgPiAwO1xuXG5leHBvcnQgY29uc3QgaXNJT1MgPSB0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJiAgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAvaVBhZHxpUGhvbmV8aVBvZC8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSAmJiAhd2luZG93WydNU1N0cmVhbSddO1xuXG5leHBvcnQgY29uc3QgaXNBbmRyb2lkID0gdHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiYgIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmXG4gICAgL0FuZHJvaWQvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgJiYgIXdpbmRvd1snTVNTdHJlYW0nXTtcblxuZXhwb3J0IGZ1bmN0aW9uIGluc3RhbGxBcmdvbkFwcCgpIHtcbiAgICBpZiAoaXNJT1MpIHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcImh0dHBzOi8vaXR1bmVzLmFwcGxlLmNvbS91cy9hcHAvYXJnb240L2lkMTA4OTMwODYwMD9tdD04XCI7XG4gICAgfSBlbHNlIGlmIChpc0FuZHJvaWQpIHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcImh0dHA6Ly9wbGF5Lmdvb2dsZS5jb20vc3RvcmUvYXBwcy9kZXRhaWxzP2lkPWVkdS5nYXRlY2guYXJnb240XCJcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvcGVuSW5BcmdvbkFwcCgpIHtcbiAgICBpZiAoaXNJT1MpIHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBgYXJnb240Oi8vb3Blbj91cmw9JHtlbmNvZGVVUklDb21wb25lbnQod2luZG93LmxvY2F0aW9uLmhyZWYpfWA7XG4gICAgfSBlbHNlIGlmIChpc0FuZHJvaWQpIHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBgaW50ZW50Oi8jSW50ZW50O3NjaGVtZT1hcmdvbjQ7cGFja2FnZT1lZHUuZ2F0ZWNoLmFyZ29uNDtTLnVybD0ke2VuY29kZVVSSUNvbXBvbmVudCh3aW5kb3cubG9jYXRpb24uaHJlZil9O2VuZGA7XG4gICAgfVxufVxuXG5cbi8vIHJlcXVlc3RBbmltYXRpb25GcmFtZSAvIGNhbmNlbEFuaW1hdGlvbkZyYW1lIHBvbHlmaWxsc1xuXG52YXIgbGFzdFRpbWUgPSAwOyBcblxuY29uc3QgckFGID0gXG4gICAgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpID9cbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLmJpbmQod2luZG93KSA6IChjYWxsYmFjaykgPT4ge1xuICAgIHZhciBjdXJyVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIHZhciB0aW1lVG9DYWxsID0gTWF0aC5tYXgoMCwgMTYgLSAoY3VyclRpbWUgLSBsYXN0VGltZSkpO1xuICAgIHZhciBpZCA9IDxudW1iZXI+PGFueT5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBjYWxsYmFjayhjdXJyVGltZSArIHRpbWVUb0NhbGwpOyB9LFxuICAgICAgICB0aW1lVG9DYWxsKTtcbiAgICBsYXN0VGltZSA9IGN1cnJUaW1lICsgdGltZVRvQ2FsbDtcbiAgICByZXR1cm4gaWQ7XG59XG5cbmNvbnN0IGNBRiA9IFxuICAgICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgPyBcbiAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUuYmluZCh3aW5kb3cpIDogY2xlYXJUaW1lb3V0O1xuXG5leHBvcnQge1xuICAgIHJBRiBhcyByZXF1ZXN0QW5pbWF0aW9uRnJhbWUsXG4gICAgY0FGIGFzIGNhbmNlbEFuaW1hdGlvbkZyYW1lXG59O1xuXG5cblxuZXhwb3J0IGZ1bmN0aW9uIGRlcHJlY2F0ZWQoYWx0ZXJuYXRpdmU/OiBzdHJpbmcpIDogTWV0aG9kRGVjb3JhdG9yIHtcbiAgICBsZXQgZGlkUHJpbnRXYXJuaW5nID0gZmFsc2U7XG5cbiAgICBjb25zdCBkZWNvcmF0b3IgPSAodGFyZ2V0LCBuYW1lOnN0cmluZywgZGVzY3JpcHRvcjpQcm9wZXJ0eURlc2NyaXB0b3IpID0+IHtcbiAgICAgICAgY29uc3Qgb3JpZ2luYWwgPSBkZXNjcmlwdG9yLmdldCB8fCBkZXNjcmlwdG9yLnZhbHVlO1xuICAgICAgICBjb25zdCBvcmlnaW5hbFR5cGUgPSB0eXBlb2YgZGVzY3JpcHRvci52YWx1ZSA9PT0gJ2Z1bmN0aW9uJyA/ICdmdW5jdGlvbicgOiAncHJvcGVydHknO1xuXG4gICAgICAgIGxldCBtZXNzYWdlID0gYFRoZSBcIiR7bmFtZX1cIiAke29yaWdpbmFsVHlwZX0gaXMgZGVwcmVjYXRlZC4gYDtcblxuICAgICAgICBpZiAoYWx0ZXJuYXRpdmUpIHtcbiAgICAgICAgICAgIGNvbnN0IGFsdGVybmF0aXZlVHlwZSA9IHR5cGVvZiB0YXJnZXRbYWx0ZXJuYXRpdmVdID09PSAnZnVuY3Rpb24nID8gJ2Z1bmN0aW9uJyA6ICdwcm9wZXJ0eSdcbiAgICAgICAgICAgIG1lc3NhZ2UgKz0gYFBsZWFzZSB1c2UgdGhlIFwiJHthbHRlcm5hdGl2ZX1cIiAke2FsdGVybmF0aXZlVHlwZX0gaW5zdGVhZC5gXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHdyYXBwZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICghZGlkUHJpbnRXYXJuaW5nKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIGRpZFByaW50V2FybmluZyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb3JpZ2luYWwhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGRlc2NyaXB0b3IudmFsdWUpIGRlc2NyaXB0b3IudmFsdWUgPSB3cmFwcGVkXG4gICAgICAgIGVsc2UgZGVzY3JpcHRvci5nZXQgPSB3cmFwcGVkO1xuXG4gICAgICAgIHJldHVybiBkZXNjcmlwdG9yO1xuICAgIH07XG5cbiAgICByZXR1cm4gZGVjb3JhdG9yO1xufVxuXG5leHBvcnQgY29uc3QgZGVmYXVsdFRlcnJhaW5Qcm92aWRlciA9IG5ldyBNYXB6ZW5UZXJyYXJpdW1UZXJyYWluUHJvdmlkZXIoe1xuICAgIHVybCA6ICdodHRwczovL3MzLmFtYXpvbmF3cy5jb20vZWxldmF0aW9uLXRpbGVzLXByb2QvdGVycmFyaXVtLycsXG4gICAgcmVxdWVzdFdhdGVyTWFzayA6IHRydWUsXG4gICAgcmVxdWVzdFZlcnRleE5vcm1hbHMgOiB0cnVlXG59KTtcblxuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlSGVpZ2h0RnJvbVRlcnJhaW4oY2FydG9ncmFwaGljIDogQ2FydG9ncmFwaGljKSA6IFByb21pc2U8Q2FydG9ncmFwaGljPiB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShzYW1wbGVUZXJyYWluKGRlZmF1bHRUZXJyYWluUHJvdmlkZXIsIDE1LCBbY2FydG9ncmFwaGljXSkudGhlbjxDYXJ0b2dyYXBoaWM+KF92YWx1ZUF0Rmlyc3RJbmRleCkpO1xufVxuXG5mdW5jdGlvbiBfdmFsdWVBdEZpcnN0SW5kZXgoYXJyYXk6Q2FydG9ncmFwaGljW10pIHtcbiAgICByZXR1cm4gYXJyYXlbMF07XG59Il19