var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
import { Matrix4, Cartesian3, Quaternion, CesiumMath } from './cesium/cesium-imports';
/**
 * Default distance from a user's eyes to the floor
 */
export var AVERAGE_EYE_HEIGHT = 1.6;
/**
 * Default near plane
 */
export var DEFAULT_NEAR_PLANE = 0.01;
/**
 * Default far plane
 */
export var DEFAULT_FAR_PLANE = 10000;
/**
 * Describes the role of an [[ArgonSystem]]
 */
export var Role;
(function (Role) {
    /**
     * A system with this role is responsible for augmenting an arbitrary view of reality,
     * generally by overlaying computer generated graphics. A reality augmentor may also,
     * if appropriate, be elevated to the role of a [[REALITY_MANAGER]].
     */
    Role[Role["AUGMENTER"] = "RealityAugmenter"] = "AUGMENTER";
    Role[Role["REALITY_AUGMENTER"] = "RealityAugmenter"] = "REALITY_AUGMENTER";
    /**
     * A system with this role is responsible for (at minimum) describing (and providing,
     * if necessary) a visual representation of the world and the 3D eye pose of the viewer.
     */
    Role[Role["REALITY"] = "RealityViewer"] = "REALITY";
    Role[Role["REALITY_VIEWER"] = "RealityViewer"] = "REALITY_VIEWER";
    /**
     * A system with this role is responsible for mediating access to sensors/trackers
     * and pose data for known entities in the world, selecting/configuring/loading
     * [[REALITY]]s, and providing the mechanism by which any given [[AUGMENTER]]
     * can augment any given [[REALITY]].
     */
    Role[Role["MANAGER"] = "RealityManager"] = "MANAGER";
    Role[Role["REALITY_MANAGER"] = "RealityManager"] = "REALITY_MANAGER";
    /**
     * Deprecated. Use [[AUGMENTER]].
     * @private
     */
    Role[Role["APPLICATION"] = "Application"] = "APPLICATION";
    /**
     * Deprecated. Use [[REALITY]]
     * @private
     */
    Role[Role["REALITY_VIEW"] = "RealityView"] = "REALITY_VIEW";
})(Role || (Role = {}));
(function (Role) {
    function isRealityViewer(r) {
        return r === Role.REALITY_VIEWER || r === Role.REALITY_VIEW;
    }
    Role.isRealityViewer = isRealityViewer;
    function isRealityAugmenter(r) {
        return r === Role.REALITY_AUGMENTER || r === Role.APPLICATION;
    }
    Role.isRealityAugmenter = isRealityAugmenter;
    function isRealityManager(r) {
        return r === Role.REALITY_MANAGER || r === "Manager";
    }
    Role.isRealityManager = isRealityManager;
    // simpler names (deprecate above)
    function isReality(r) {
        return Role.isRealityViewer(r);
    }
    Role.isReality = isReality;
    function isAugmenter(r) {
        return Role.isRealityAugmenter(r);
    }
    Role.isAugmenter = isAugmenter;
    function isManager(r) {
        return Role.isRealityManager(r);
    }
    Role.isManager = isManager;
})(Role || (Role = {}));
/**
 * Configuration options for an [[ArgonSystem]]
 */
var Configuration = (function () {
    function Configuration() {
    }
    return Configuration;
}());
export { Configuration };
var Viewport = (function () {
    function Viewport() {
        this.x = 0;
        this.y = 0;
        this.width = 0;
        this.height = 0;
    }
    Viewport.clone = function (viewport, result) {
        if (result === void 0) { result = new Viewport; }
        if (!viewport)
            return undefined;
        result.x = viewport.x;
        result.y = viewport.y;
        result.width = viewport.width;
        result.height = viewport.height;
        return result;
    };
    Viewport.equals = function (viewportA, viewportB) {
        return viewportA && viewportB &&
            CesiumMath.equalsEpsilon(viewportA.x, viewportB.x, CesiumMath.EPSILON7) &&
            CesiumMath.equalsEpsilon(viewportA.y, viewportB.y, CesiumMath.EPSILON7) &&
            CesiumMath.equalsEpsilon(viewportA.width, viewportB.width, CesiumMath.EPSILON7) &&
            CesiumMath.equalsEpsilon(viewportA.height, viewportB.height, CesiumMath.EPSILON7);
    };
    return Viewport;
}());
export { Viewport };
/**
 * Viewport values are expressed using a right-handed coordinate system with the origin
 * at the bottom left corner.
 */
var CanvasViewport = (function (_super) {
    __extends(CanvasViewport, _super);
    function CanvasViewport() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.pixelRatio = 1;
        _this.renderWidthScaleFactor = 1;
        _this.renderHeightScaleFactor = 1;
        return _this;
    }
    CanvasViewport.clone = function (viewport, result) {
        if (result === void 0) { result = new CanvasViewport; }
        if (!viewport)
            return undefined;
        Viewport.clone(viewport, result);
        result.renderWidthScaleFactor = viewport.renderWidthScaleFactor;
        result.renderHeightScaleFactor = viewport.renderHeightScaleFactor;
        return result;
    };
    CanvasViewport.equals = function (viewportA, viewportB) {
        return viewportA && viewportB && Viewport.equals(viewportA, viewportB) &&
            CesiumMath.equalsEpsilon(viewportA.renderWidthScaleFactor, viewportB.renderWidthScaleFactor, CesiumMath.EPSILON7) &&
            CesiumMath.equalsEpsilon(viewportA.renderHeightScaleFactor, viewportB.renderHeightScaleFactor, CesiumMath.EPSILON7);
    };
    return CanvasViewport;
}(Viewport));
export { CanvasViewport };
/**
 * Identifies a subview in a [[SerializedSubview]]
 */
export var SubviewType;
(function (SubviewType) {
    /*
     * Identities a subview for a handheld display.
     */
    SubviewType[SubviewType["SINGULAR"] = "Singular"] = "SINGULAR";
    /*
     * Identifies a subview for the left eye (when the user is wearing an HMD or Viewer)
     */
    SubviewType[SubviewType["LEFTEYE"] = "LeftEye"] = "LEFTEYE";
    /*
     * Identifies a subview for the right eye (when the user is wearing an HMD or Viewer)
     */
    SubviewType[SubviewType["RIGHTEYE"] = "RightEye"] = "RIGHTEYE";
    /*
     * Identifies a subview for a custom view configuration
     */
    SubviewType[SubviewType["OTHER"] = "Other"] = "OTHER";
})(SubviewType || (SubviewType = {}));
export var SerializedEntityState;
(function (SerializedEntityState) {
    function clone(state, result) {
        if (!state)
            return null;
        result = result || {};
        result.p = Cartesian3.clone(state.p, result.p);
        result.o = Quaternion.clone(state.o, result.o);
        result.r = state.r;
        result.meta = state.meta;
        return result;
    }
    SerializedEntityState.clone = clone;
})(SerializedEntityState || (SerializedEntityState = {}));
export var SerializedSubview;
(function (SerializedSubview) {
    function clone(subview, result) {
        result = result || {};
        result.type = subview.type;
        result.projectionMatrix = Matrix4.clone(subview.projectionMatrix, result.projectionMatrix);
        result.viewport = Viewport.clone(subview.viewport, result.viewport);
        // result.pose = subview.pose ? SerializedEntityState.clone(subview.pose, result.pose) : undefined;
        return result;
    }
    SerializedSubview.clone = clone;
    function equals(left, right) {
        return left && right &&
            left.type === right.type &&
            Viewport.equals(left.viewport, right.viewport) &&
            Matrix4.equals(left.projectionMatrix, right.projectionMatrix);
    }
    SerializedSubview.equals = equals;
})(SerializedSubview || (SerializedSubview = {}));
// export interface PhysicalViewState {
//     time: JulianDate,
//     stagePose: SerializedEntityPose|undefined,
//     stageHorizontalAccuracy: number|undefined,
//     stageVerticalAccuracy: number|undefined,
//     eyePose: SerializedEntityPose|undefined,
//     eyeCompassAccuracy: number|undefined,
//     subviews: SerializedSubviewList,
//     strict:boolean;
// }
// export interface ViewState {
//     /**
//      * The viewing pose.
//      */
//     pose: SerializedEntityState|undefined,
//     /**
//      * The viewport to render into. In a DOM environment, 
//      * the bottom left corner of the document element (document.documentElement) 
//      * is the origin. 
//      */
//     viewport: Viewport,
//     /**
//      * The list of subviews to render.
//      */
//     subviews:SerializedSubviewList,
//     /**
//      * The current field of view (of each subview)
//      */
//     fovs: number[]
// }
var SerializedSubviewList = (function (_super) {
    __extends(SerializedSubviewList, _super);
    function SerializedSubviewList() {
        return _super.call(this) || this;
    }
    SerializedSubviewList.clone = function (subviews, result) {
        if (!subviews)
            return undefined;
        result = result || new SerializedSubviewList;
        result.length = subviews.length;
        for (var i = 0; i < subviews.length; i++) {
            var s = subviews[i];
            result[i] = SerializedSubview.clone(s, result[i]);
        }
        return result;
    };
    return SerializedSubviewList;
}(Array));
export { SerializedSubviewList };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29tbW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFjLFVBQVUsRUFBZ0IsVUFBVSxFQUFFLFVBQVUsRUFBRSxNQUFNLHlCQUF5QixDQUFBO0FBRS9HOztHQUVHO0FBQ0gsTUFBTSxDQUFDLElBQU0sa0JBQWtCLEdBQUcsR0FBRyxDQUFDO0FBRXRDOztHQUVHO0FBQ0gsTUFBTSxDQUFDLElBQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDO0FBRXZDOztHQUVHO0FBQ0gsTUFBTSxDQUFDLElBQU0saUJBQWlCLEdBQUcsS0FBSyxDQUFDO0FBRXZDOztHQUVHO0FBQ0gsTUFBTSxDQUFOLElBQVksSUFxQ1g7QUFyQ0QsV0FBWSxJQUFJO0lBRVo7Ozs7T0FJRztJQUNILHlCQUFZLGtCQUF5QixlQUFBLENBQUE7SUFDckMsaUNBQW9CLGtCQUF5Qix1QkFBQSxDQUFBO0lBRTdDOzs7T0FHRztJQUNILHVCQUFVLGVBQXNCLGFBQUEsQ0FBQTtJQUNoQyw4QkFBaUIsZUFBc0Isb0JBQUEsQ0FBQTtJQUV2Qzs7Ozs7T0FLRztJQUNILHVCQUFVLGdCQUF1QixhQUFBLENBQUE7SUFDakMsK0JBQWtCLGdCQUF1QixxQkFBQSxDQUFBO0lBRXpDOzs7T0FHRztJQUNILDJCQUFjLGFBQW9CLGlCQUFBLENBQUE7SUFFbEM7OztPQUdHO0lBQ0gsNEJBQWUsYUFBb0Isa0JBQUEsQ0FBQTtBQUN2QyxDQUFDLEVBckNXLElBQUksS0FBSixJQUFJLFFBcUNmO0FBRUQsV0FBaUIsSUFBSTtJQUNqQix5QkFBZ0MsQ0FBTztRQUNuQyxNQUFNLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxjQUFjLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxZQUFZLENBQUM7SUFDaEUsQ0FBQztJQUZlLG9CQUFlLGtCQUU5QixDQUFBO0lBQ0QsNEJBQW1DLENBQU87UUFDdEMsTUFB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LENBQUMsTUFBTSxDQUFDO1FBQ2hDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ3JDLElBQU0sQ0FBQyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0QixNQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxNQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4RCxDQUFDO1FBQ0QsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUNsQixDQUFDO0lBQ0wsNEJBQUM7QUFBRCxDQUFDLEFBZEQsQ0FBMkMsS0FBSyxHQWMvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1hdHJpeDQsIEp1bGlhbkRhdGUsIENhcnRlc2lhbjMsIENhcnRvZ3JhcGhpYywgUXVhdGVybmlvbiwgQ2VzaXVtTWF0aCB9IGZyb20gJy4vY2VzaXVtL2Nlc2l1bS1pbXBvcnRzJ1xuXG4vKipcbiAqIERlZmF1bHQgZGlzdGFuY2UgZnJvbSBhIHVzZXIncyBleWVzIHRvIHRoZSBmbG9vclxuICovXG5leHBvcnQgY29uc3QgQVZFUkFHRV9FWUVfSEVJR0hUID0gMS42O1xuXG4vKipcbiAqIERlZmF1bHQgbmVhciBwbGFuZVxuICovXG5leHBvcnQgY29uc3QgREVGQVVMVF9ORUFSX1BMQU5FID0gMC4wMTtcblxuLyoqXG4gKiBEZWZhdWx0IGZhciBwbGFuZVxuICovXG5leHBvcnQgY29uc3QgREVGQVVMVF9GQVJfUExBTkUgPSAxMDAwMDtcblxuLyoqXG4gKiBEZXNjcmliZXMgdGhlIHJvbGUgb2YgYW4gW1tBcmdvblN5c3RlbV1dXG4gKi9cbmV4cG9ydCBlbnVtIFJvbGUge1xuXG4gICAgLyoqXG4gICAgICogQSBzeXN0ZW0gd2l0aCB0aGlzIHJvbGUgaXMgcmVzcG9uc2libGUgZm9yIGF1Z21lbnRpbmcgYW4gYXJiaXRyYXJ5IHZpZXcgb2YgcmVhbGl0eSxcbiAgICAgKiBnZW5lcmFsbHkgYnkgb3ZlcmxheWluZyBjb21wdXRlciBnZW5lcmF0ZWQgZ3JhcGhpY3MuIEEgcmVhbGl0eSBhdWdtZW50b3IgbWF5IGFsc28sIFxuICAgICAqIGlmIGFwcHJvcHJpYXRlLCBiZSBlbGV2YXRlZCB0byB0aGUgcm9sZSBvZiBhIFtbUkVBTElUWV9NQU5BR0VSXV0uIFxuICAgICAqL1xuICAgIEFVR01FTlRFUiA9IFwiUmVhbGl0eUF1Z21lbnRlclwiIGFzIGFueSxcbiAgICBSRUFMSVRZX0FVR01FTlRFUiA9IFwiUmVhbGl0eUF1Z21lbnRlclwiIGFzIGFueSxcblxuICAgIC8qKlxuICAgICAqIEEgc3lzdGVtIHdpdGggdGhpcyByb2xlIGlzIHJlc3BvbnNpYmxlIGZvciAoYXQgbWluaW11bSkgZGVzY3JpYmluZyAoYW5kIHByb3ZpZGluZywgXG4gICAgICogaWYgbmVjZXNzYXJ5KSBhIHZpc3VhbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgd29ybGQgYW5kIHRoZSAzRCBleWUgcG9zZSBvZiB0aGUgdmlld2VyLlxuICAgICAqL1xuICAgIFJFQUxJVFkgPSBcIlJlYWxpdHlWaWV3ZXJcIiBhcyBhbnksXG4gICAgUkVBTElUWV9WSUVXRVIgPSBcIlJlYWxpdHlWaWV3ZXJcIiBhcyBhbnksXG5cbiAgICAvKipcbiAgICAgKiBBIHN5c3RlbSB3aXRoIHRoaXMgcm9sZSBpcyByZXNwb25zaWJsZSBmb3IgbWVkaWF0aW5nIGFjY2VzcyB0byBzZW5zb3JzL3RyYWNrZXJzIFxuICAgICAqIGFuZCBwb3NlIGRhdGEgZm9yIGtub3duIGVudGl0aWVzIGluIHRoZSB3b3JsZCwgc2VsZWN0aW5nL2NvbmZpZ3VyaW5nL2xvYWRpbmcgXG4gICAgICogW1tSRUFMSVRZXV1zLCBhbmQgcHJvdmlkaW5nIHRoZSBtZWNoYW5pc20gYnkgd2hpY2ggYW55IGdpdmVuIFtbQVVHTUVOVEVSXV1cbiAgICAgKiBjYW4gYXVnbWVudCBhbnkgZ2l2ZW4gW1tSRUFMSVRZXV0uIFxuICAgICAqL1xuICAgIE1BTkFHRVIgPSBcIlJlYWxpdHlNYW5hZ2VyXCIgYXMgYW55LFxuICAgIFJFQUxJVFlfTUFOQUdFUiA9IFwiUmVhbGl0eU1hbmFnZXJcIiBhcyBhbnksXG5cbiAgICAvKipcbiAgICAgKiBEZXByZWNhdGVkLiBVc2UgW1tBVUdNRU5URVJdXS4gXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBBUFBMSUNBVElPTiA9IFwiQXBwbGljYXRpb25cIiBhcyBhbnksXG5cbiAgICAvKipcbiAgICAgKiBEZXByZWNhdGVkLiBVc2UgW1tSRUFMSVRZXV1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIFJFQUxJVFlfVklFVyA9IFwiUmVhbGl0eVZpZXdcIiBhcyBhbnksXG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgUm9sZSB7XG4gICAgZXhwb3J0IGZ1bmN0aW9uIGlzUmVhbGl0eVZpZXdlcihyPzpSb2xlKSB7XG4gICAgICAgIHJldHVybiByID09PSBSb2xlLlJFQUxJVFlfVklFV0VSIHx8IHIgPT09IFJvbGUuUkVBTElUWV9WSUVXO1xuICAgIH1cbiAgICBleHBvcnQgZnVuY3Rpb24gaXNSZWFsaXR5QXVnbWVudGVyKHI/OlJvbGUpIHtcbiAgICAgICAgcmV0dXJuIHIgPT09IFJvbGUuUkVBTElUWV9BVUdNRU5URVIgfHwgciA9PT0gUm9sZS5BUFBMSUNBVElPTjtcbiAgICB9XG4gICAgZXhwb3J0IGZ1bmN0aW9uIGlzUmVhbGl0eU1hbmFnZXIocj86Um9sZSkge1xuICAgICAgICByZXR1cm4gciA9PT0gUm9sZS5SRUFMSVRZX01BTkFHRVIgfHwgciA9PT0gPGFueT5cIk1hbmFnZXJcIjtcbiAgICB9XG5cbiAgICAvLyBzaW1wbGVyIG5hbWVzIChkZXByZWNhdGUgYWJvdmUpXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGlzUmVhbGl0eShyPzpSb2xlKSB7XG4gICAgICAgIHJldHVybiBSb2xlLmlzUmVhbGl0eVZpZXdlcihyKTtcbiAgICB9XG4gICAgZXhwb3J0IGZ1bmN0aW9uIGlzQXVnbWVudGVyKHI/OlJvbGUpIHtcbiAgICAgICAgcmV0dXJuIFJvbGUuaXNSZWFsaXR5QXVnbWVudGVyKHIpO1xuICAgIH1cbiAgICBleHBvcnQgZnVuY3Rpb24gaXNNYW5hZ2VyKHI/OlJvbGUpIHtcbiAgICAgICAgcmV0dXJuIFJvbGUuaXNSZWFsaXR5TWFuYWdlcihyKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ29uZmlndXJhdGlvbiBvcHRpb25zIGZvciBhbiBbW0FyZ29uU3lzdGVtXV0gXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBDb25maWd1cmF0aW9uIHtcbiAgICB2ZXJzaW9uPzogbnVtYmVyW107XG4gICAgdXJpPzogc3RyaW5nO1xuICAgIHRpdGxlPzogc3RyaW5nO1xuICAgIHJvbGU/OiBSb2xlO1xuICAgIHByb3RvY29scz86IHN0cmluZ1tdO1xuICAgIHVzZXJEYXRhPzogYW55O1xuICAgIC8vIG90aGVyIG9wdGlvbnMgLyBoaW50c1xuICAgIGRlZmF1bHRVST86IHtcbiAgICAgICAgZGlzYWJsZT86IGJvb2xlYW5cbiAgICB9O1xuICAgICdzdXBwb3J0c0N1c3RvbVByb3RvY29scyc/OiBib29sZWFuO1xuICAgICdzaGFyZWRDYW52YXMnPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNsYXNzIFZpZXdwb3J0IHtcbiAgICB4OiBudW1iZXIgPSAwO1xuICAgIHk6IG51bWJlciA9IDA7XG4gICAgd2lkdGg6IG51bWJlciA9IDA7XG4gICAgaGVpZ2h0OiBudW1iZXIgPSAwO1xuXG4gICAgc3RhdGljIGNsb25lKHZpZXdwb3J0PzpWaWV3cG9ydCwgcmVzdWx0OlZpZXdwb3J0PW5ldyBWaWV3cG9ydCkge1xuICAgICAgICBpZiAoIXZpZXdwb3J0KSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICByZXN1bHQueCA9IHZpZXdwb3J0Lng7XG4gICAgICAgIHJlc3VsdC55ID0gdmlld3BvcnQueTtcbiAgICAgICAgcmVzdWx0LndpZHRoID0gdmlld3BvcnQud2lkdGg7XG4gICAgICAgIHJlc3VsdC5oZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQ7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgc3RhdGljIGVxdWFscyh2aWV3cG9ydEE/OlZpZXdwb3J0LCB2aWV3cG9ydEI/OlZpZXdwb3J0KSB7XG4gICAgICAgIHJldHVybiB2aWV3cG9ydEEgJiYgdmlld3BvcnRCICYmIFxuICAgICAgICBDZXNpdW1NYXRoLmVxdWFsc0Vwc2lsb24odmlld3BvcnRBLngsIHZpZXdwb3J0Qi54LCBDZXNpdW1NYXRoLkVQU0lMT043KSAmJlxuICAgICAgICBDZXNpdW1NYXRoLmVxdWFsc0Vwc2lsb24odmlld3BvcnRBLnksIHZpZXdwb3J0Qi55LCBDZXNpdW1NYXRoLkVQU0lMT043KSAmJlxuICAgICAgICBDZXNpdW1NYXRoLmVxdWFsc0Vwc2lsb24odmlld3BvcnRBLndpZHRoLCB2aWV3cG9ydEIud2lkdGgsIENlc2l1bU1hdGguRVBTSUxPTjcpICYmXG4gICAgICAgIENlc2l1bU1hdGguZXF1YWxzRXBzaWxvbih2aWV3cG9ydEEuaGVpZ2h0LCB2aWV3cG9ydEIuaGVpZ2h0LCBDZXNpdW1NYXRoLkVQU0lMT043KTtcbiAgICB9XG59XG5cbi8qKlxuICogVmlld3BvcnQgdmFsdWVzIGFyZSBleHByZXNzZWQgdXNpbmcgYSByaWdodC1oYW5kZWQgY29vcmRpbmF0ZSBzeXN0ZW0gd2l0aCB0aGUgb3JpZ2luXG4gKiBhdCB0aGUgYm90dG9tIGxlZnQgY29ybmVyLlxuICovXG5leHBvcnQgY2xhc3MgQ2FudmFzVmlld3BvcnQgZXh0ZW5kcyBWaWV3cG9ydCB7XG4gICAgcGl4ZWxSYXRpbzogbnVtYmVyID0gMTtcbiAgICByZW5kZXJXaWR0aFNjYWxlRmFjdG9yOiBudW1iZXIgPSAxO1xuICAgIHJlbmRlckhlaWdodFNjYWxlRmFjdG9yOiBudW1iZXIgPSAxO1xuXG4gICAgc3RhdGljIGNsb25lKHZpZXdwb3J0PzpDYW52YXNWaWV3cG9ydCwgcmVzdWx0OkNhbnZhc1ZpZXdwb3J0PTxhbnk+bmV3IENhbnZhc1ZpZXdwb3J0KSB7XG4gICAgICAgIGlmICghdmlld3BvcnQpIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIFZpZXdwb3J0LmNsb25lKHZpZXdwb3J0LCByZXN1bHQpO1xuICAgICAgICByZXN1bHQucmVuZGVyV2lkdGhTY2FsZUZhY3RvciA9IHZpZXdwb3J0LnJlbmRlcldpZHRoU2NhbGVGYWN0b3I7XG4gICAgICAgIHJlc3VsdC5yZW5kZXJIZWlnaHRTY2FsZUZhY3RvciA9IHZpZXdwb3J0LnJlbmRlckhlaWdodFNjYWxlRmFjdG9yO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIHN0YXRpYyBlcXVhbHModmlld3BvcnRBPzpDYW52YXNWaWV3cG9ydCwgdmlld3BvcnRCPzpDYW52YXNWaWV3cG9ydCkge1xuICAgICAgICByZXR1cm4gdmlld3BvcnRBICYmIHZpZXdwb3J0QiAmJiBWaWV3cG9ydC5lcXVhbHModmlld3BvcnRBLCB2aWV3cG9ydEIpICYmXG4gICAgICAgIENlc2l1bU1hdGguZXF1YWxzRXBzaWxvbih2aWV3cG9ydEEucmVuZGVyV2lkdGhTY2FsZUZhY3Rvciwgdmlld3BvcnRCLnJlbmRlcldpZHRoU2NhbGVGYWN0b3IsIENlc2l1bU1hdGguRVBTSUxPTjcpICYmXG4gICAgICAgIENlc2l1bU1hdGguZXF1YWxzRXBzaWxvbih2aWV3cG9ydEEucmVuZGVySGVpZ2h0U2NhbGVGYWN0b3IsIHZpZXdwb3J0Qi5yZW5kZXJIZWlnaHRTY2FsZUZhY3RvciwgQ2VzaXVtTWF0aC5FUFNJTE9ONyk7XG4gICAgfVxufVxuXG4vKipcbiAqIElkZW50aWZpZXMgYSBzdWJ2aWV3IGluIGEgW1tTZXJpYWxpemVkU3Vidmlld11dXG4gKi9cbmV4cG9ydCBlbnVtIFN1YnZpZXdUeXBlIHtcbiAgICAvKlxuICAgICAqIElkZW50aXRpZXMgYSBzdWJ2aWV3IGZvciBhIGhhbmRoZWxkIGRpc3BsYXkuXG4gICAgICovXG4gICAgU0lOR1VMQVIgPSBcIlNpbmd1bGFyXCIgYXMgYW55LFxuXG4gICAgLypcbiAgICAgKiBJZGVudGlmaWVzIGEgc3VidmlldyBmb3IgdGhlIGxlZnQgZXllICh3aGVuIHRoZSB1c2VyIGlzIHdlYXJpbmcgYW4gSE1EIG9yIFZpZXdlcilcbiAgICAgKi9cbiAgICBMRUZURVlFID0gXCJMZWZ0RXllXCIgYXMgYW55LFxuXG4gICAgLypcbiAgICAgKiBJZGVudGlmaWVzIGEgc3VidmlldyBmb3IgdGhlIHJpZ2h0IGV5ZSAod2hlbiB0aGUgdXNlciBpcyB3ZWFyaW5nIGFuIEhNRCBvciBWaWV3ZXIpXG4gICAgICovXG4gICAgUklHSFRFWUUgPSBcIlJpZ2h0RXllXCIgYXMgYW55LFxuXG4gICAgLypcbiAgICAgKiBJZGVudGlmaWVzIGEgc3VidmlldyBmb3IgYSBjdXN0b20gdmlldyBjb25maWd1cmF0aW9uXG4gICAgICovXG4gICAgT1RIRVIgPSBcIk90aGVyXCIgYXMgYW55LFxufVxuXG4vKipcbiAqIEEgc2VyaWFsaXplZCBub3RhdGlvbiBmb3IgdGhlIHBvc2l0aW9uLCBvcmllbnRhdGlvbiwgYW5kIHJlZmVyZW5jZUZyYW1lIG9mIGFuIGVudGl0eS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTZXJpYWxpemVkRW50aXR5U3RhdGUge1xuICAgIHA6IENhcnRlc2lhbjMsIC8vIHBvc2l0aW9uXG4gICAgbzogUXVhdGVybmlvbiwgLy8gb3JpZW50YXRpb25cbiAgICByOiBudW1iZXIgfCBzdHJpbmcsIC8vIHJlZmVyZW5jZSBmcmFtZVxuICAgIG1ldGE/OiBhbnkgLy8gbWV0YSBkYXRhXG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgU2VyaWFsaXplZEVudGl0eVN0YXRlIHtcbiAgICBleHBvcnQgZnVuY3Rpb24gY2xvbmUoc3RhdGU/OlNlcmlhbGl6ZWRFbnRpdHlTdGF0ZSwgcmVzdWx0PzpTZXJpYWxpemVkRW50aXR5U3RhdGV8bnVsbCkge1xuICAgICAgICBpZiAoIXN0YXRlKSByZXR1cm4gbnVsbDtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0IHx8IDxTZXJpYWxpemVkRW50aXR5U3RhdGU+PGFueT57fTtcbiAgICAgICAgcmVzdWx0LnAgPSBDYXJ0ZXNpYW4zLmNsb25lKHN0YXRlLnAsIHJlc3VsdC5wKTtcbiAgICAgICAgcmVzdWx0Lm8gPSBRdWF0ZXJuaW9uLmNsb25lKHN0YXRlLm8sIHJlc3VsdC5vKTtcbiAgICAgICAgcmVzdWx0LnIgPSBzdGF0ZS5yO1xuICAgICAgICByZXN1bHQubWV0YSA9IHN0YXRlLm1ldGE7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgbWFwIG9mIGVudGl0eSBpZHMgYW5kIHRoZWlyIGFzc29jaWF0ZWQgcG9zZXMuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU2VyaWFsaXplZEVudGl0eVN0YXRlTWFwIHtcbiAgICBbaWQ6IHN0cmluZ106IFNlcmlhbGl6ZWRFbnRpdHlTdGF0ZSB8IG51bGxcbn1cblxuLyoqXG4gKiBUaGUgc2VyaWFsaXplZCByZW5kZXJpbmcgcGFyYW1ldGVycyBmb3IgYSBwYXJ0aWN1bGFyIHN1YnZpZXdcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTZXJpYWxpemVkU3VidmlldyB7XG4gICAgdHlwZTogU3Vidmlld1R5cGUsXG4gICAgLyoqXG4gICAgICogVGhlIHByb2plY3Rpb24gbWF0cml4IGZvciB0aGlzIHN1YnZpZXdcbiAgICAgKi9cbiAgICBwcm9qZWN0aW9uTWF0cml4OiBNYXRyaXg0LFxuICAgIC8qKlxuICAgICAqIFRoZSB2aWV3cG9ydCBmb3IgdGhpcyBzdWJ2aWV3IChyZWxhdGl2ZSB0byB0aGUgcHJpbWFyeSB2aWV3cG9ydClcbiAgICAgKi9cbiAgICB2aWV3cG9ydDogVmlld3BvcnRcbiAgICAvKipcbiAgICAgKiBUaGUgcG9zZSBmb3IgdGhpcyBzdWJ2aWV3IChyZWxhdGl2ZSB0byB0aGUgcHJpbWFyeSBwb3NlKVxuICAgICAqL1xuICAgIC8vIHBvc2U6IFNlcmlhbGl6ZWRFbnRpdHlTdGF0ZXxudWxsfHVuZGVmaW5lZCwgLy8gaWYgdW5kZWZpbmVkLCBpZGVudGl0eSBpcyBhc3N1bWVkXG59XG5cblxuLyoqXG4gKiBUaGUgc2VyaWFsaXplZCByZW5kZXJpbmcgcGFyYW1ldGVycyBmb3IgYSBwYXJ0aWN1bGFyIHN1YnZpZXdcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBSZWFkb25seVNlcmlhbGl6ZWRTdWJ2aWV3IHtcbiAgICByZWFkb25seSB0eXBlOiBTdWJ2aWV3VHlwZSxcbiAgICAvKipcbiAgICAgKiBUaGUgcHJvamVjdGlvbiBtYXRyaXggZm9yIHRoaXMgc3Vidmlld1xuICAgICAqL1xuICAgIHJlYWRvbmx5IHByb2plY3Rpb25NYXRyaXg6IFJlYWRvbmx5PE1hdHJpeDQ+LFxuICAgIC8qKlxuICAgICAqIFRoZSB2aWV3cG9ydCBmb3IgdGhpcyBzdWJ2aWV3IChyZWxhdGl2ZSB0byB0aGUgcHJpbWFyeSB2aWV3cG9ydClcbiAgICAgKi9cbiAgICByZWFkb25seSB2aWV3cG9ydDogUmVhZG9ubHk8Q2FudmFzVmlld3BvcnQ+XG4gICAgLy8gLyoqXG4gICAgLy8gICogVGhlIHBvc2UgZm9yIHRoaXMgc3VidmlldyAocmVsYXRpdmUgdG8gdGhlIHByaW1hcnkgcG9zZSlcbiAgICAvLyAgKi9cbiAgICAvLyByZWFkb25seSBwb3NlPzogUmVhZG9ubHk8U2VyaWFsaXplZEVudGl0eVN0YXRlPiwgLy8gaWYgdW5kZWZpbmVkLCBpZGVudGl0eSBpcyBhc3N1bWVkXG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgU2VyaWFsaXplZFN1YnZpZXcge1xuICAgIGV4cG9ydCBmdW5jdGlvbiBjbG9uZShzdWJ2aWV3OlNlcmlhbGl6ZWRTdWJ2aWV3LCByZXN1bHQ/OlNlcmlhbGl6ZWRTdWJ2aWV3KSB7XG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdCB8fCA8U2VyaWFsaXplZFN1YnZpZXc+e307XG4gICAgICAgIHJlc3VsdC50eXBlID0gc3Vidmlldy50eXBlO1xuICAgICAgICByZXN1bHQucHJvamVjdGlvbk1hdHJpeCA9IE1hdHJpeDQuY2xvbmUoc3Vidmlldy5wcm9qZWN0aW9uTWF0cml4LCByZXN1bHQucHJvamVjdGlvbk1hdHJpeCk7XG4gICAgICAgIHJlc3VsdC52aWV3cG9ydCA9IFZpZXdwb3J0LmNsb25lKHN1YnZpZXcudmlld3BvcnQsIHJlc3VsdC52aWV3cG9ydCkhO1xuICAgICAgICAvLyByZXN1bHQucG9zZSA9IHN1YnZpZXcucG9zZSA/IFNlcmlhbGl6ZWRFbnRpdHlTdGF0ZS5jbG9uZShzdWJ2aWV3LnBvc2UsIHJlc3VsdC5wb3NlKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgZXhwb3J0IGZ1bmN0aW9uIGVxdWFscyhsZWZ0PzpTZXJpYWxpemVkU3VidmlldywgcmlnaHQ/OlNlcmlhbGl6ZWRTdWJ2aWV3KSB7XG4gICAgICAgIHJldHVybiBsZWZ0ICYmIHJpZ2h0ICYmIFxuICAgICAgICAgICAgbGVmdC50eXBlID09PSByaWdodC50eXBlICYmXG4gICAgICAgICAgICBWaWV3cG9ydC5lcXVhbHMobGVmdC52aWV3cG9ydCwgcmlnaHQudmlld3BvcnQpICYmIFxuICAgICAgICAgICAgTWF0cml4NC5lcXVhbHMobGVmdC5wcm9qZWN0aW9uTWF0cml4LCByaWdodC5wcm9qZWN0aW9uTWF0cml4KTtcbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VyaWFsaXplZERldmljZVN0YXRlIHtcbiAgICBjdXJyZW50Rm92OiBudW1iZXI7XG4gICAgZXllQ2FydG9ncmFwaGljUG9zaXRpb246IENhcnRvZ3JhcGhpY3x1bmRlZmluZWQ7XG4gICAgZXllSG9yaXpvbnRhbEFjY3VyYWN5OiBudW1iZXJ8dW5kZWZpbmVkO1xuICAgIGV5ZVZlcnRpY2FsQWNjdXJhY3k6IG51bWJlcnx1bmRlZmluZWQ7XG4gICAgdmlld3BvcnQ6IENhbnZhc1ZpZXdwb3J0O1xuICAgIHN1YnZpZXdzOiBTZXJpYWxpemVkU3Vidmlld1tdO1xuICAgIHN0cmljdFN1YnZpZXdzOiBib29sZWFuO1xuICAgIGlzUHJlc2VudGluZ0hNRDogYm9vbGVhbjtcbn1cblxuLy8gZXhwb3J0IGludGVyZmFjZSBQaHlzaWNhbFZpZXdTdGF0ZSB7XG4vLyAgICAgdGltZTogSnVsaWFuRGF0ZSxcbi8vICAgICBzdGFnZVBvc2U6IFNlcmlhbGl6ZWRFbnRpdHlQb3NlfHVuZGVmaW5lZCxcbi8vICAgICBzdGFnZUhvcml6b250YWxBY2N1cmFjeTogbnVtYmVyfHVuZGVmaW5lZCxcbi8vICAgICBzdGFnZVZlcnRpY2FsQWNjdXJhY3k6IG51bWJlcnx1bmRlZmluZWQsXG4vLyAgICAgZXllUG9zZTogU2VyaWFsaXplZEVudGl0eVBvc2V8dW5kZWZpbmVkLFxuLy8gICAgIGV5ZUNvbXBhc3NBY2N1cmFjeTogbnVtYmVyfHVuZGVmaW5lZCxcbi8vICAgICBzdWJ2aWV3czogU2VyaWFsaXplZFN1YnZpZXdMaXN0LFxuLy8gICAgIHN0cmljdDpib29sZWFuO1xuLy8gfVxuXG4vLyBleHBvcnQgaW50ZXJmYWNlIFZpZXdTdGF0ZSB7XG4vLyAgICAgLyoqXG4vLyAgICAgICogVGhlIHZpZXdpbmcgcG9zZS5cbi8vICAgICAgKi9cbi8vICAgICBwb3NlOiBTZXJpYWxpemVkRW50aXR5U3RhdGV8dW5kZWZpbmVkLFxuXG4vLyAgICAgLyoqXG4vLyAgICAgICogVGhlIHZpZXdwb3J0IHRvIHJlbmRlciBpbnRvLiBJbiBhIERPTSBlbnZpcm9ubWVudCwgXG4vLyAgICAgICogdGhlIGJvdHRvbSBsZWZ0IGNvcm5lciBvZiB0aGUgZG9jdW1lbnQgZWxlbWVudCAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSBcbi8vICAgICAgKiBpcyB0aGUgb3JpZ2luLiBcbi8vICAgICAgKi9cbi8vICAgICB2aWV3cG9ydDogVmlld3BvcnQsXG5cbi8vICAgICAvKipcbi8vICAgICAgKiBUaGUgbGlzdCBvZiBzdWJ2aWV3cyB0byByZW5kZXIuXG4vLyAgICAgICovXG4vLyAgICAgc3Vidmlld3M6U2VyaWFsaXplZFN1YnZpZXdMaXN0LFxuXG4vLyAgICAgLyoqXG4vLyAgICAgICogVGhlIGN1cnJlbnQgZmllbGQgb2YgdmlldyAob2YgZWFjaCBzdWJ2aWV3KVxuLy8gICAgICAqL1xuLy8gICAgIGZvdnM6IG51bWJlcltdXG4vLyB9XG5cbmV4cG9ydCBjbGFzcyBTZXJpYWxpemVkU3Vidmlld0xpc3QgZXh0ZW5kcyBBcnJheTxTZXJpYWxpemVkU3Vidmlldz4ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgIH1cbiAgICBzdGF0aWMgY2xvbmUoc3Vidmlld3M/OlNlcmlhbGl6ZWRTdWJ2aWV3TGlzdCwgcmVzdWx0PzpTZXJpYWxpemVkU3Vidmlld0xpc3QpIHtcbiAgICAgICAgaWYgKCFzdWJ2aWV3cykgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0IHx8IG5ldyBTZXJpYWxpemVkU3Vidmlld0xpc3Q7XG4gICAgICAgIHJlc3VsdC5sZW5ndGggPSBzdWJ2aWV3cy5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IGk9MDsgaSA8IHN1YnZpZXdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gc3Vidmlld3NbaV07XG4gICAgICAgICAgICByZXN1bHQhW2ldID0gU2VyaWFsaXplZFN1YnZpZXcuY2xvbmUocywgcmVzdWx0IVtpXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG59XG5cblxuLy8gZXhwb3J0IG5hbWVzcGFjZSBWaWV3U3RhdGUge1xuLy8gICAgIGV4cG9ydCBmdW5jdGlvbiBjbG9uZSh2aWV3U3RhdGU6Vmlld1N0YXRlLCByZXN1bHQ/OlZpZXdTdGF0ZSkge1xuLy8gICAgICAgICByZXN1bHQgPSByZXN1bHQgfHwgPFZpZXdTdGF0ZT57fTtcbi8vICAgICAgICAgcmVzdWx0LnRpbWUgPSBKdWxpYW5EYXRlLmNsb25lKHZpZXdTdGF0ZS50aW1lLCByZXN1bHQudGltZSk7XG4vLyAgICAgICAgIHJlc3VsdC5zdGFnZVBvc2UgPSB2aWV3U3RhdGUuc3RhZ2VQb3NlID8gU2VyaWFsaXplZEVudGl0eVN0YXRlLmNsb25lKHZpZXdTdGF0ZS5zdGFnZVBvc2UsIHJlc3VsdC5zdGFnZVBvc2UpIDogdW5kZWZpbmVkO1xuLy8gICAgICAgICByZXN1bHQucG9zZSA9IHZpZXdTdGF0ZS5wb3NlID8gU2VyaWFsaXplZEVudGl0eVN0YXRlLmNsb25lKHZpZXdTdGF0ZS5wb3NlLCByZXN1bHQucG9zZSkgOiB1bmRlZmluZWQ7XG4vLyAgICAgICAgIHJlc3VsdC52aWV3cG9ydCA9IFZpZXdwb3J0LmNsb25lKHZpZXdTdGF0ZS52aWV3cG9ydCwgcmVzdWx0LnZpZXdwb3J0KTtcbi8vICAgICAgICAgcmVzdWx0LnN1YnZpZXdzID0gcmVzdWx0LnN1YnZpZXdzIHx8IFtdO1xuLy8gICAgICAgICByZXN1bHQuZm92cyA9IHJlc3VsdC5mb3ZzIHx8IFtdO1xuLy8gICAgICAgICB2aWV3U3RhdGUuc3Vidmlld3MuZm9yRWFjaCgocywgaSk9Pntcbi8vICAgICAgICAgICAgIHJlc3VsdCEuc3Vidmlld3NbaV0gPSBTZXJpYWxpemVkU3Vidmlldy5jbG9uZShzLCByZXN1bHQhLnN1YnZpZXdzW2ldKTtcbi8vICAgICAgICAgfSk7XG4vLyAgICAgICAgIHZpZXdTdGF0ZS5mb3ZzLmZvckVhY2goKGYsIGkpPT57XG4vLyAgICAgICAgICAgICByZXN1bHQhLmZvdnNbaV0gPSBmXG4vLyAgICAgICAgIH0pO1xuLy8gICAgICAgICByZXR1cm4gcmVzdWx0O1xuLy8gICAgIH1cbi8vIH1cblxuLyoqXG4gKiBEZXNjcmliZXMgdGhlIHBvc2Ugb2YgYSByZWFsaXR5IHZpZXcgYW5kIGhvdyBpdCBpcyBhYmxlIHRvIHJlbmRlclxuICovXG5leHBvcnQgaW50ZXJmYWNlIERlcHJlY2F0ZWRFeWVQYXJhbWV0ZXJzIHtcbiAgICB2aWV3cG9ydD86IENhbnZhc1ZpZXdwb3J0OyAvLyBkZWZhdWx0OiBtYXhpbXVtXG4gICAgcG9zZT86IFNlcmlhbGl6ZWRFbnRpdHlTdGF0ZTtcbiAgICBzdGVyZW9NdWx0aXBsaWVyPzogbnVtYmVyOyAvLyBkZWZhdWx0OiAxXG4gICAgZm92PzogbnVtYmVyOyAvLyBkZWZhdWx0OiBkZWZlciB0byBtYW5hZ2VyXG4gICAgYXNwZWN0PzogbnVtYmVyOyAvLyBkZWZhdWx0OiBtYXRjaGVzIHZpZXdwb3J0IFxufVxuXG4vKipcbiAqIERlcHJlY2F0ZWQuIFNlZSBbW1ZpZXdTcGVjXV1cbiAqIERlc2NyaWJlcyB0aGUgcGFydGlhbCBmcmFtZSBzdGF0ZSByZXBvcnRlZCBieSByZWFsaXR5IHZpZXdlcnMgYmVmb3JlIHYxLjFcbiAqIEBkZXByZWNhdGVkXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRGVwcmVjYXRlZFBhcnRpYWxGcmFtZVN0YXRlIHtcbiAgICBpbmRleDogbnVtYmVyLFxuICAgIHRpbWU6IHsgZGF5TnVtYmVyOiBudW1iZXIsIHNlY29uZHNPZkRheTogbnVtYmVyIH0sIC8vIEp1bGlhbkRhdGUsXG4gICAgdmlldz86IGFueSxcbiAgICBleWU/OiBEZXByZWNhdGVkRXllUGFyYW1ldGVycyxcbiAgICBlbnRpdGllcz86IFNlcmlhbGl6ZWRFbnRpdHlTdGF0ZU1hcFxufVxuXG4vKipcbiAqIERlc2NyaWJlcyBhIGNvbXBsZXRlIGZyYW1lIHN0YXRlIHdoaWNoIGlzIHNlbnQgdG8gY2hpbGQgc2Vzc2lvbnNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDb250ZXh0RnJhbWVTdGF0ZSB7XG4gICAgdGltZTogSnVsaWFuRGF0ZSxcbiAgICB2aWV3cG9ydDogQ2FudmFzVmlld3BvcnQsXG4gICAgc3Vidmlld3M6IFNlcmlhbGl6ZWRTdWJ2aWV3TGlzdCxcbiAgICByZWFsaXR5Pzogc3RyaW5nLFxuICAgIGluZGV4PzogbnVtYmVyLFxuICAgIGVudGl0aWVzOiBTZXJpYWxpemVkRW50aXR5U3RhdGVNYXAsXG4gICAgc2VuZFRpbWU/OiBKdWxpYW5EYXRlLCAvLyB0aGUgdGltZSB0aGlzIHN0YXRlIHdhcyBzZW50XG4gICAgdXNlclRyYWNraW5nPzogJ25vbmUnfCczRE9GJ3wnNkRPRicsXG4gICAgZGlzcGxheU1vZGU/OiAnaGFuZCd8J2hlYWQnfCdvdGhlcidcbn1cblxuZXhwb3J0IGludGVyZmFjZSBHZW9sb2NhdGlvbk9wdGlvbnMge1xuICAgIGVuYWJsZUhpZ2hBY2N1cmFjeT86IGJvb2xlYW47XG59Il19